/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x14ec26 from'./../messagescompressor.js';import _0x1deead from'./messages/addcommentmessage.js';import _0x16152f from'./responses/addcommentresponse.js';import _0x1efc06 from'./messages/connectmessage.js';import _0x3d4708 from'./responses/connectresponse.js';import _0x3b81fa from'./messages/removecommentmessage.js';import _0x4fa081 from'./messages/removecommentthreadmessage.js';import _0x1abe3c from'./messages/updatecommentmessage.js';import _0x1efd5d from'./messages/getcommentthreadmessage.js';import _0x584f39 from'./responses/getcommentthreadresponse.js';import _0x3ecbaf from'./messages/getdocumentthreadsmessage.js';import _0x3641d3 from'./responses/getdocumentthreadsresponse.js';import _0x466fb4,{WEB_SOCKET_GATEWAY_STATES}from'./../websocketgateway/websocketgateway.js';import _0x236156 from'./../ckeditorcloudserviceserror.js';import _0x3f9b28 from'../sessions/sessions.js';import _0x568080 from'../errors/ServiceNotConnectedError.js';import _0x376c9d from'../ckeditorcloudservicesservererror.js';import _0x4ad4e9 from'./responses/comment-threads/addcommentthreadresponse.js';import _0x37637a from'./messages/comment-threads/addcommentthreadmessage.js';import _0x199bc1 from'./messages/comment-threads/resolvecommentthreadmessage.js';import _0xcbc3e7 from'./messages/comment-threads/reopencommentthreadmessage.js';import _0x3b2ec7 from'./messages/comment-threads/updatecommentthreadmessage.js';import _0x302c11 from'./responses/comment-threads/resolvecommentthreadresponse.js';export const _SERVICE=0x9;class CommentsService extends/* #__PURE__ -- @preserve */
EmitterMixin(){['_documentId'];['_isConnected']=!0x1;['_wsGateway'];['_channel'];['_connectedSessions'];static ['_SERVICE']=0x9;constructor(_0x1a9659){super(),this['_documentId']=_0x1a9659;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x42f99b){if(this['_isConnected'])return;if(_0x42f99b['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x236156('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x42f99b);const _0x1180f7=new _0x1efc06(this['_documentId']);this['_wsGateway']=_0x42f99b,this['stopListening'](_0x42f99b,'change:state');const _0x5e5acf=await _0x42f99b['_sendRequest'](0x9,_0x1efc06['TYPE'],_0x14ec26['encode'](_0x1180f7)),{channel:_0x1c9cda,threads:_0x1f418f}=_0x14ec26['decode'](_0x5e5acf,_0x3d4708);return this['listenTo'](_0x42f99b,'change:state',(_0xee9fd2,_0x17d9d4,_0x4f096b)=>this['_onWsGatewayStateChange'](_0x4f096b),{'priority':_0x466fb4['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x42f99b,_0x1c9cda),this['_isConnected']=!0x0,this['fire']('connected'),_0x1f418f;}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['_connectedSessions']&&(this['_connectedSessions']['disconnect'](),this['_connectedSessions']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['addComment'](_0x2701af,_0x1faa44,_0x576119,_0x4e710c){const _0x40e08c=new _0x1deead(this['_documentId'],_0x2701af,_0x576119,_0x1faa44,void 0x0,void 0x0,_0x4e710c),_0x49cce3=await this['_sendRequest'](_0x1deead['TYPE'],_0x40e08c);return _0x14ec26['decode'](_0x49cce3,_0x16152f);}async['updateComment'](_0x2ab1e5,_0x295384,_0x267c24,_0x46b1f6){const _0x3612f3=void 0x0!==_0x46b1f6,_0x378623=new _0x1abe3c(this['_documentId'],_0x2ab1e5,_0x295384,_0x267c24,_0x46b1f6,_0x3612f3);await this['_sendRequest'](_0x1abe3c['TYPE'],_0x378623);}async['removeComment'](_0x59747e,_0x27835c){const _0x4bbea4=new _0x3b81fa(this['_documentId'],_0x59747e,_0x27835c);await this['_sendRequest'](_0x3b81fa['TYPE'],_0x4bbea4);}async['removeCommentThread'](_0x40936e){const _0x515e38=new _0x4fa081(this['_documentId'],_0x40936e);await this['_sendRequest'](_0x4fa081['TYPE'],_0x515e38);}async['addCommentThread'](_0x297888){const _0xbbb425=new _0x37637a(this['_documentId'],_0x297888['commentThreadId'],_0x297888['comments']?.['map'](_0x5f2542=>({..._0x5f2542,'documentId':this['_documentId'],'commentThreadId':_0x297888['commentThreadId']})),_0x297888['context'],_0x297888['resolvedBy'],_0x297888['createdAt'],_0x297888['resolvedAt'],_0x297888['deletedAt'],_0x297888['attributes']),_0x5e7704=await this['_sendRequest'](_0x37637a['TYPE'],_0xbbb425);return _0x14ec26['decode'](_0x5e7704,_0x4ad4e9);}async['resolveCommentThread'](_0x24cbbd){const _0x723db3=new _0x199bc1(_0x24cbbd,this['_documentId']),_0x100096=await this['_sendRequest'](_0x199bc1['TYPE'],_0x723db3);return _0x14ec26['decode'](_0x100096,_0x302c11);}async['reopenCommentThread'](_0x3fe982){const _0x1020ed=new _0xcbc3e7(_0x3fe982,this['_documentId']);await this['_sendRequest'](_0xcbc3e7['TYPE'],_0x1020ed);}async['updateCommentThread'](_0x455a19){const _0x4461bf=new _0x3b2ec7(_0x455a19['commentThreadId'],this['_documentId'],_0x455a19['context'],_0x455a19['attributes'],_0x455a19['unlinkedAt']);await this['_sendRequest'](_0x3b2ec7['TYPE'],_0x4461bf);}async['getCommentThread'](_0x3c20aa,_0x253fcc=0x1){const _0xa2d527=new _0x1efd5d(_0x3c20aa,this['_documentId']);try{const _0x482075=await this['_sendRequest'](_0x1efd5d['TYPE'],_0xa2d527),_0x39690d=_0x14ec26['decode'](_0x482075,_0x584f39);return{'commentThreadId':_0x39690d['commentThreadId'],'comments':_0x39690d['comments'],'attributes':_0x39690d['attributes'],'context':_0x39690d['context'],'resolvedAt':_0x39690d['resolvedAt'],'resolvedBy':_0x39690d['resolvedBy'],'deletedAt':_0x39690d['deletedAt'],'unlinkedAt':_0x39690d['unlinkedAt']};}catch(_0x2171ef){if('CKEditorCloudServicesServerError'===_0x2171ef['name']&&'404'===_0x2171ef['code']&&_0x253fcc<0x5)return await(_0x438226=0x64*_0x253fcc,new Promise(_0x194235=>{setTimeout(_0x194235,_0x438226);})),this['getCommentThread'](_0x3c20aa,_0x253fcc+0x1);if('CKEditorCloudServicesServerError'===_0x2171ef['name'])throw _0x2171ef;throw _0x376c9d['fromPublicError'](_0x2171ef);}var _0x438226;}async['getDocumentThreads'](){const _0x49c090=new _0x3ecbaf(this['_documentId']),_0x182f67=await this['_sendRequest'](_0x3ecbaf['TYPE'],_0x49c090),{threads:_0x5d678a}=_0x14ec26['decode'](_0x182f67,_0x3641d3);return{'threads':_0x5d678a};}async['getConnectedSessions'](){if(!this['_isConnected'])throw new _0x568080('Comments',this);return this['_connectedSessions']||(this['_connectedSessions']=await _0x3f9b28['getConnectedSessions'](this['_wsGateway'],this['_documentId'],0x9)),this['_connectedSessions'];}['_connectToChannel'](_0x38e644,_0x1ef4fb){this['_channel']=_0x38e644['_getChannel'](CommentsService['_SERVICE'],_0x1ef4fb),this['_channel']&&(this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x1deead['TYPE']),(_0x36d366,_0x2ff2e5)=>{const _0x2a2dc0=_0x14ec26['decode'](_0x2ff2e5,_0x1deead);this['fire']('commentAdded',_0x2a2dc0);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x3b81fa['TYPE']),(_0x1d7843,_0x3c3786)=>{const _0xbd5a2f=_0x14ec26['decode'](_0x3c3786,_0x3b81fa);this['fire']('commentRemoved',_0xbd5a2f);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x1abe3c['TYPE']),(_0x1ed390,_0x422901)=>{const _0x5749e9=_0x14ec26['decode'](_0x422901,_0x1abe3c);this['fire']('commentUpdated',_0x5749e9);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x4fa081['TYPE']),(_0x161822,_0x1ea1e1)=>{const _0x437d8e=_0x14ec26['decode'](_0x1ea1e1,_0x4fa081);this['fire']('commentThreadRemoved',_0x437d8e);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x37637a['TYPE']),(_0x3b8374,_0x10454f)=>{const _0x1cc989=_0x14ec26['decode'](_0x10454f,_0x37637a);this['fire']('commentThreadAdded',_0x1cc989);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x3b2ec7['TYPE']),(_0x1f35b9,_0x3ba618)=>{const _0x541446=_0x14ec26['decode'](_0x3ba618,_0x3b2ec7);this['fire']('commentThreadUpdated',_0x541446);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x199bc1['TYPE']),(_0x513fc3,_0x837e11)=>{const _0x59c87f=_0x14ec26['decode'](_0x837e11,_0x199bc1);this['fire']('commentThreadResolved',_0x59c87f);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0xcbc3e7['TYPE']),(_0x550584,_0x575849)=>{const _0x43ae02=_0x14ec26['decode'](_0x575849,_0xcbc3e7);this['fire']('commentThreadReopened',_0x43ae02);}));}['_onWsGatewayStateChange'](_0x1d9a16){_0x1d9a16===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x4dc214,_0x35a309){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x568080('Comments',this);return this['_wsGateway']['_sendRequest'](0x9,_0x4dc214,_0x14ec26['encode'](_0x35a309));}}export default CommentsService;
/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x184cdb from'./../messagescompressor.js';import _0x4e672f from'./messages/addsuggestionmessage.js';import _0x5019f5 from'./responses/addsuggestionresponse.js';import _0x1f5bd6 from'./messages/getsuggestionmessage.js';import _0x180247 from'./responses/getsuggestionresponse.js';import _0x275061 from'./messages/getallsuggestionsmessage.js';import _0x3acf46 from'./responses/getallsuggestionsresponse.js';import _0x3a8c25 from'./messages/updatesuggestionmessage.js';import _0x3d48c0 from'./messages/connectmessage.js';import _0x2c9f0c from'./responses/connectresponse.js';import _0x3ed41a from'../ckeditorcloudserviceserror.js';import _0x5168ff,{WEB_SOCKET_GATEWAY_STATES}from'../websocketgateway/websocketgateway.js';import _0x4c7041 from'../errors/ServiceNotConnectedError.js';import _0x37b3e9 from'../ckeditorcloudservicesservererror.js';import _0x56ce3f from'./messages/batchUpdateSuggestionsStateMessage.js';export const _SERVICE=0xa;class TrackChangesService extends/* #__PURE__ -- @preserve */
EmitterMixin(){['_documentId'];['_isConnected']=!0x1;['_wsGateway'];['_channel'];static ['_SERVICE']=0xa;constructor(_0x25a91b){super(),this['_documentId']=_0x25a91b;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x17bded){if(this['_isConnected'])return;if(_0x17bded['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x3ed41a('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x17bded);const _0x3ab63f=new _0x3d48c0(this['_documentId']);this['_wsGateway']=_0x17bded,this['stopListening'](_0x17bded,'change:state');const _0x1e6d8a=await _0x17bded['_sendRequest'](0xa,_0x3d48c0['TYPE'],_0x184cdb['encode'](_0x3ab63f)),_0x5f2298=_0x184cdb['decode'](_0x1e6d8a,_0x2c9f0c);return this['listenTo'](_0x17bded,'change:state',(_0x20908f,_0x415e3d,_0x349273)=>this['_onWsGatewayStateChange'](_0x349273),{'priority':_0x5168ff['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x17bded,_0x5f2298['channel']),this['_isConnected']=!0x0,this['fire']('connected'),_0x5f2298['suggestions'];}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['add'](_0xed3982,_0x2597b9,_0x5766c2,_0x3ca004=null,_0x28ce12){const _0x3abe32=new _0x4e672f(_0xed3982,this['_documentId'],_0x2597b9,_0x5766c2,_0x3ca004,_0x28ce12),_0x4b0071=await this['_sendRequest'](_0x4e672f['TYPE'],_0x3abe32);return _0x184cdb['decode'](_0x4b0071,_0x5019f5);}async['get'](_0x422b29,_0xca124=0x1){const _0x10b483=new _0x1f5bd6(_0x422b29,this['_documentId']);try{const _0x2bed3c=await this['_sendRequest'](_0x1f5bd6['TYPE'],_0x10b483);return _0x184cdb['decode'](_0x2bed3c,_0x180247);}catch(_0x4821fe){if('CKEditorCloudServicesServerError'===_0x4821fe['name']&&'404'===_0x4821fe['code']&&_0xca124<0x5)return await(_0x30c2fc=0x64*_0xca124,new Promise(_0x129482=>{setTimeout(_0x129482,_0x30c2fc);})),this['get'](_0x422b29,_0xca124+0x1);if('CKEditorCloudServicesServerError'===_0x4821fe['name'])throw _0x4821fe;throw _0x37b3e9['fromPublicError'](_0x4821fe);}var _0x30c2fc;}async['getAll'](){const _0x5a58ed=new _0x275061(this['_documentId']),_0x3452de=await this['_sendRequest'](_0x275061['TYPE'],_0x5a58ed),{suggestions:_0x7fdf4a}=_0x184cdb['decode'](_0x3452de,_0x3acf46);return _0x7fdf4a;}async['update'](_0x3e3c3a,_0x576308={}){const {hasComments:_0x4ee234,state:_0x45997a,attributes:_0x235719}=_0x576308,_0x28682c=void 0x0!==_0x4ee234,_0x30a11e=new _0x3a8c25(_0x3e3c3a,this['_documentId'],_0x4ee234,_0x28682c,_0x45997a,_0x235719);await this['_sendRequest'](_0x3a8c25['TYPE'],_0x30a11e);}async['batchUpdateState'](_0xedead1){const _0x391bdd=new _0x56ce3f(_0xedead1['ids'],this['_documentId'],_0xedead1['state']);await this['_sendRequest'](_0x56ce3f['TYPE'],_0x391bdd);}['_connectToChannel'](_0x14420d,_0x57bd11){this['_channel']=_0x14420d['_getChannel'](TrackChangesService['_SERVICE'],_0x57bd11),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x3a8c25['TYPE']),(_0x3f0535,_0x1549dc)=>{const _0x42d7cf=_0x184cdb['decode'](_0x1549dc,_0x3a8c25);this['fire']('suggestionUpdated',_0x42d7cf);});}['_onWsGatewayStateChange'](_0x3deef7){_0x3deef7===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x1dde4d,_0x534767){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x4c7041('Track\x20Changes',this);return this['_wsGateway']['_sendRequest'](0xa,_0x1dde4d,_0x184cdb['encode'](_0x534767));}}export default TrackChangesService;
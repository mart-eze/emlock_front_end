/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x316043 from'./../messagescompressor.js';import _0x31520c from'./messages/revisionhistorygetrevisionmessage.js';import _0xbc11cf from'./responses/revisionhistorygetrevisionresponse.js';import _0x206060 from'./messages/revisionhistoryupdaterevisionsmessage.js';import _0x3587ee from'./responses/revisionhistoryupdaterevisionsresponse.js';import _0x5679dd from'./messages/revisionhistoryconnectmessage.js';import _0x3dcc61 from'./responses/revisionhistoryconnectresponse.js';import _0xd3be83 from'./messages/revisionhistoryreconnectmessage.js';import _0x150b51 from'../ckeditorcloudserviceserror.js';import _0x1503c6,{WEB_SOCKET_GATEWAY_STATES}from'../websocketgateway/websocketgateway.js';import _0x1a3044 from'../errors/ServiceNotConnectedError.js';export const _SERVICE=0xc;class RevisionHistoryService extends/* #__PURE__ -- @preserve */
EmitterMixin(){['_documentId'];['_isConnected']=!0x1;['_wsGateway'];['_channel'];static ['_SERVICE']=0xc;constructor(_0x1c7795){super(),this['_documentId']=_0x1c7795;}get['isConnected'](){return this['_isConnected'];}['connect'](_0x44b28e){return this['_isConnected']?Promise['resolve']():this['_connect'](_0x44b28e,new _0x5679dd(this['_documentId']));}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}['reconnect'](_0x4af103,_0x49a6ff){if(this['isConnected'])throw new _0x150b51('Cannot\x20reconnect\x20to\x20already\x20connected\x20service.',_0x4af103);return this['_connect'](_0x4af103,new _0xd3be83(this['_documentId'],_0x49a6ff));}async['updateRevisions'](_0x345d03,_0x11f153){const _0xfb3c2e=_0x206060['create']({'documentId':this['_documentId'],'requestId':_0x11f153,'revisions':_0x345d03}),_0x38e428=await this['_sendRequest'](_0x206060['TYPE'],_0xfb3c2e),{requestId:_0x3784de}=_0x316043['decode'](_0x38e428,_0x3587ee);return _0x3784de;}async['getRevision'](_0x783c50){const _0x5df615=new _0x31520c(this['_documentId'],_0x783c50),_0x4e0f5b=await this['_sendRequest'](_0x31520c['TYPE'],_0x5df615);return _0x316043['decode'](_0x4e0f5b,_0xbc11cf)['toObject']();}async['_connect'](_0x43bff2,_0x3c41c4){if(_0x43bff2['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x150b51('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x43bff2);this['_wsGateway']=_0x43bff2,this['stopListening'](_0x43bff2,'change:state');const _0x54b047=await _0x43bff2['_sendRequest'](0xc,_0x3c41c4['constructor']['TYPE'],_0x316043['encode'](_0x3c41c4)),{channel:_0x1f62ce,requestId:_0x303112,revisions:_0x21874a}=_0x316043['decode'](_0x54b047,_0x3dcc61)['toObject']();return this['listenTo'](_0x43bff2,'change:state',(_0x140a3f,_0x266888,_0x41ecfb)=>this['_onWsGatewayStateChange'](_0x41ecfb),{'priority':_0x1503c6['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x43bff2,_0x1f62ce),this['_isConnected']=!0x0,this['fire']('connected'),{'revisions':_0x21874a,'requestId':_0x303112};}['_connectToChannel'](_0x57bc28,_0x33c991){this['_channel']=_0x57bc28['_getChannel'](RevisionHistoryService['_SERVICE'],_0x33c991),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x206060['TYPE']),(_0x27c9f3,_0x3a110e)=>{const {documentId:_0x12d40c,requestId:_0x1f39e7,revisions:_0x1127a9}=_0x316043['decode'](_0x3a110e,_0x206060)['toObject']();this['fire']('revisionsUpdated',{'documentId':_0x12d40c,'requestId':_0x1f39e7,'revisionsData':_0x1127a9});});}['_onWsGatewayStateChange'](_0x191278){_0x191278===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x4023b6,_0x66a0c6){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x1a3044('Revision\x20History',this);return this['_wsGateway']['_sendRequest'](0xc,_0x4023b6,_0x316043['encode'](_0x66a0c6));}}export default RevisionHistoryService;
/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{ContextPlugin as _0x353ca5,Plugin as _0x325c29,PendingActions as _0x4665b8,Context as _0x3457e7}from'@ckeditor/ckeditor5-core/dist/index.js';import{DomEmitterMixin as _0x4e1d64,CKEditorError as _0x1f3dd5,Collection as _0x9408dd,global as _0x22ed95,version as nt,uid as _0x3c5f05,KeystrokeHandler as _0x43ab47}from'@ckeditor/ckeditor5-utils/dist/index.js';import{Notification as _0x3ce412,View as _0x314b86,ListView as _0x1a6b86,ListItemView as rt,LabelView as ot,BalloonPanelView as _0x169d4d,clickOutsideHandler as _0x48669f,BodyCollection as _0x55c731}from'@ckeditor/ckeditor5-ui/dist/index.js';import{LiveRange as ht,History as _0x37ca4c,NoOperation as _0x4a9ec7,InsertOperation as _0x275bde,MarkerOperation as _0x36e6fd,RootAttributeOperation as _0x55f2ce,transformSets as _0x3667f8,OperationFactory as _0x26bbab}from'@ckeditor/ckeditor5-engine/dist/index.js';import{WebSocketGateway as lt,WEB_SOCKET_GATEWAY_STATES as _0x281a71,CollaborativeEditingService as _0x5cc764,User as dt,CommentsService as _0x13fd90,TrackChangesService as et,RevisionHistoryService as it,EditorService as tt}from'@ckeditor/ckeditor-cloud-services-collaboration/dist/index.js';import{Users as _0x14c341,UserView as ct}from'ckeditor5-collaboration/dist/index.js';import{Compressor as _0x42ebdd}from'@ckeditor/ckeditor5-operations-compressor/dist/index.js';import{isElement as _0x3b8005}from'es-toolkit/compat';class c extends _0x353ca5{static ['WebSocketGateway']=/* #__PURE__ -- @preserve */
((()=>lt)());static ['initialReconnectionInterval']=0x3e8;['connection'];['_reconnectionStack'];['_shouldPluginsReconnect'];['_domEmitter'];static get['requires'](){return['CloudServices',_0x3ce412];}static get['pluginName'](){return'WebSocketGateway';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}constructor(_0x3d08b5){super(_0x3d08b5),this['set']('state',_0x281a71['CONNECTED']),this['set']('_isBrowserOffline',!0x1),this['_reconnectionStack']=new Set(),this['_shouldPluginsReconnect']=!0x1,this['_domEmitter']=Object['create'](_0x4e1d64);}['init'](){const _0xffe858=this['context'],_0x542101=_0xffe858['plugins']['get']('CloudServices'),_0x333066=_0xffe858['plugins']['get'](_0x3ce412);if(!_0x542101['token'])throw new _0x1f3dd5('websocketgateway-missing-token',this);if(!_0x542101['webSocketUrl'])throw new _0x1f3dd5('websocketgateway-missing-websocket-url',this);return this['_domEmitter']['listenTo'](window,'offline',()=>this['_isBrowserOffline']=!0x0),this['_domEmitter']['listenTo'](window,'online',()=>this['_isBrowserOffline']=!0x1),this['context']['config']['define']('cloudServices.connectionTimeout',0xa),this['context']['config']['define']('cloudServices.requestTimeout',0x14),c['WebSocketGateway']['connect'](_0x542101['token'],_0x542101['webSocketUrl'],{'timeout':0x3e8*this['context']['config']['get']('cloudServices.connectionTimeout'),'requestTimeout':0x3e8*this['context']['config']['get']('cloudServices.requestTimeout')})['then'](_0x5513c4=>{if(this['connection']=_0x5513c4,this['bind']('state')['to'](_0x5513c4,'state',this,'_isBrowserOffline',(_0x51f055,_0x595024)=>('connected'!==_0x51f055&&(this['_shouldPluginsReconnect']=!0x0),_0x595024||_0x51f055!==_0x281a71['CONNECTED']?_0x281a71['DISCONNECTED']:this['state']==_0x281a71['DISCONNECTED']&&this['_shouldPluginsReconnect']?(this['_shouldPluginsReconnect']=!0x1,this['_reconnect'](),_0x281a71['CONNECTING']):_0x281a71['CONNECTED'])),this['connection']['on']('error',(_0x4304fc,_0x54c23e)=>{if('limitExceeded'!==_0x54c23e['code'])throw console['error'](_0x54c23e),new _0x1f3dd5('cloudservices-init',null,{'originalError':_0x54c23e});_0x333066['showWarning']('The\x20limit\x20of\x20maximum\x20concurrent\x20connections\x20that\x20the\x20collaboration\x20server\x20can\x20handle\x20has\x20been\x20reached.\x20Try\x20opening\x20the\x20document\x20again\x20in\x20a\x20few\x20minutes.\x20Please\x20contact\x20your\x20system\x20administrator\x20if\x20the\x20problem\x20persists.',{'title':'Connected\x20users\x20limit\x20exceeded','namespace':'real-time-collaboration'});}),!_0x5513c4['me'])return new Promise(_0xa801c2=>_0x5513c4['on']('change:me',_0xa801c2));})['catch'](_0x1fb454=>{throw console['error'](_0x1fb454),new _0x1f3dd5('cloudservices-init',null,{'originalError':_0x1fb454});});}['addToReconnectionStack'](_0x1b2f1d){if('function'!=typeof _0x1b2f1d['reconnect'])throw new _0x1f3dd5('websocketgateway-invalid-plugin-interface',this);if(this['isInReconnectionStack'](_0x1b2f1d))throw new _0x1f3dd5('websocketgateway-plugin-already-registered',this,{'name':_0x1b2f1d['constructor']['pluginName']});this['_reconnectionStack']['add'](_0x1b2f1d);}['removeFromReconnectionStack'](_0x436a76){this['_reconnectionStack']['delete'](_0x436a76);}['isInReconnectionStack'](_0x22f4c7){return this['_reconnectionStack']['has'](_0x22f4c7);}['_reconnect'](){return this['connection']['reconnect']()['then'](()=>Promise['all'](Array['from'](this['_reconnectionStack'],_0x570427=>_0x570427['reconnect']())))['then'](()=>this['state']=_0x281a71['CONNECTED'])['catch'](_0x4595c3=>{throw console['error'](_0x4595c3),new _0x1f3dd5('cloudservices-reconnection-error',this['context']);});}['disconnect'](){this['connection']&&this['connection']['disconnect'](),this['state']=_0x281a71['DISCONNECTED'],this['_domEmitter']['stopListening']();}['destroy'](){this['disconnect'](),super['destroy']();}}class i extends _0x353ca5{['channelSessions'];['channelConnectedUsers'];['allConnectedUsers'];['_registeredSessions'];['_uniqueUsersCount'];['_users'];static get['pluginName'](){return'Sessions';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}static get['requires'](){return[c,_0x14c341];}constructor(_0x4bf06b){super(_0x4bf06b),this['channelSessions']=new Map(),this['channelConnectedUsers']=new Map(),this['allConnectedUsers']=new _0x9408dd(),this['_registeredSessions']=new Map(),this['_uniqueUsersCount']=0x0,this['_users']=this['context']['plugins']['get'](_0x14c341);}['init'](){const _0x41721e=this['context']['plugins']['get'](c);this['listenTo'](_0x41721e,'change:state',(_0x3e0cfb,_0x199c3d,_0x143ee2)=>{if('connected'!==_0x143ee2)this['channelSessions']['forEach'](_0x326d91=>_0x326d91['clear']()),this['channelConnectedUsers']['forEach'](_0xf3ed11=>_0xf3ed11['clear']()),this['allConnectedUsers']['clear']();else{for(const [_0x13457e,_0x1b6cb6]of this['_registeredSessions'])for(const _0xbc52d9 of _0x1b6cb6)this['_handleSessionAdd'](_0x13457e,_0xbc52d9);}}),this['_createUser'](_0x41721e['connection']['me'],!0x0);}['register'](_0x338990,_0x40849a){if(this['_registeredSessions']['has'](_0x338990))throw new _0x1f3dd5('sessions-register-already-registered',null,{'channelId':_0x338990});this['_registeredSessions']['set'](_0x338990,_0x40849a),this['channelSessions']['set'](_0x338990,new _0x9408dd()),this['channelConnectedUsers']['set'](_0x338990,new _0x9408dd()),this['listenTo'](_0x40849a,'add',(_0x51cfda,_0x294d52)=>this['_handleSessionAdd'](_0x338990,_0x294d52)),this['listenTo'](_0x40849a,'remove',(_0x374bee,_0x1a0ba1)=>this['_handleSessionRemove'](_0x338990,_0x1a0ba1));for(const _0x285f0e of _0x40849a)this['_handleSessionAdd'](_0x338990,_0x285f0e);}['unregister'](_0x40719c){if(!this['_registeredSessions']['has'](_0x40719c))throw new _0x1f3dd5('sessions-unregister-not-exist',null,{'channelId':_0x40719c});const _0x33c58d=this['_registeredSessions']['get'](_0x40719c);this['stopListening'](_0x33c58d);for(const _0x1f00b4 of _0x33c58d)'connected'===this['context']['plugins']['get'](c)['state']&&this['_handleSessionRemove'](_0x40719c,_0x1f00b4);this['_registeredSessions']['delete'](_0x40719c),this['channelSessions']['delete'](_0x40719c),this['channelConnectedUsers']['delete'](_0x40719c);}get['mySessionId'](){return this['context']['plugins']['get'](c)['connection']['sessionId'];}['getUserBySessionId'](_0x387447){for(const _0x40fa93 of this['channelSessions']['values']())for(const _0x57ea22 of _0x40fa93)if(_0x57ea22['id']===_0x387447)return _0x57ea22['user'];}['getUserSessions'](_0x2215d9,_0x13ef5f){const _0x54cf58=_0x13ef5f?[this['channelSessions']['get'](_0x13ef5f)]:this['channelSessions']['values'](),_0x3b4a2f=new Set();for(const _0x3a1e87 of _0x54cf58)for(const _0x42e964 of _0x3a1e87)_0x42e964['user']['id']===_0x2215d9['id']&&_0x3b4a2f['add'](_0x42e964['id']);return _0x3b4a2f;}['getUserRole'](_0x19f1fb){for(const _0xa9d6a7 of this['channelSessions']['values']())for(const _0x59f956 of _0xa9d6a7)if(_0x59f956['user']===_0x19f1fb)return _0x59f956['role'];}['_handleSessionAdd'](_0x246af6,_0x474453){if('connected'!==this['context']['plugins']['get'](c)['state'])return;const _0x8051e4=_0x474453['user'],_0x212189=this['_users']['getUser'](_0x8051e4['id'])||this['_createUser'](_0x8051e4),_0x4bb1a9=Object['assign']({},_0x474453,{'user':_0x212189});this['channelSessions']['get'](_0x246af6)['add'](_0x4bb1a9);const _0x5c6d6b=this['channelConnectedUsers']['get'](_0x246af6);_0x5c6d6b['has'](_0x212189['id'])||_0x5c6d6b['add'](_0x212189),this['allConnectedUsers']['has'](_0x212189['id'])||this['allConnectedUsers']['add'](_0x212189,_0x212189['isMe']?0x0:void 0x0),this['fire']('sessionAdd:'+_0x246af6,{'channelId':_0x246af6,'session':_0x4bb1a9});}['_handleSessionRemove'](_0x2f0913,_0x33ad65){if('connected'!==this['context']['plugins']['get'](c)['state'])return;const _0x56ef34=this['channelConnectedUsers']['get'](_0x2f0913),_0x60405e=_0x33ad65['user'];_0x60405e['id']&&(this['channelSessions']['get'](_0x2f0913)['remove'](_0x33ad65['id']),_0x56ef34['has'](_0x60405e['id'])&&!this['getUserSessions'](_0x60405e,_0x2f0913)['size']&&_0x56ef34['remove'](_0x60405e['id']),this['allConnectedUsers']['get'](_0x60405e['id'])&&!this['getUserSessions'](_0x60405e)['size']&&this['allConnectedUsers']['remove'](_0x60405e['id']));}['_createUser'](_0x2ff131,_0x157f00){const _0xa30b22=this['_users']['addUser'](_0x2ff131);return _0x157f00&&this['_users']['defineMe'](_0x2ff131['id']),_0xa30b22['orderNumber']=this['_uniqueUsersCount']++,_0xa30b22;}}class q extends _0x325c29{['_domEmitter']=new(_0x4e1d64())();static get['requires'](){return[i];}static get['pluginName'](){return'UserMarkers';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}['init'](){const _0x2b7e43=this['editor'],_0x4a644d=_0x2b7e43['plugins']['get'](i);_0x2b7e43['conversion']['for']('editingDowncast')['markerToElement']({'model':'user:position','view':(_0x1ec39f,{writer:_0x1cedd0})=>function(_0x5151e2,_0x39ee8f,_0x290938,_0x295fa6){const _0x40bb5d=_0x5151e2['markerName']['split'](':')[0x2],_0x30cbba=_0x290938['getUserBySessionId'](_0x40bb5d);if(!_0x30cbba||_0x40bb5d===_0x290938['mySessionId'])return;if(!_0x295fa6['model']['schema']['checkChild'](_0x5151e2['markerRange']['start'],'$text'))return;const _0x1b5196={'class':'ck-user__marker\x20'+_0x30cbba['color']['getMarkerClass'](),'data-name':_0x30cbba['name'],'data-session-id':_0x40bb5d},_0x3e6286=_0x295fa6['model']['markers']['get'](_0x5151e2['markerName']),_0x37e03e=_0x3e6286['getStart'](),_0x32605a=_0x37e03e['nodeAfter'],_0x15ece7=_0x295fa6['model']['schema'];if(_0x32605a&&_0x15ece7['isObject'](_0x32605a)&&_0x15ece7['isInline'](_0x32605a)&&!_0x295fa6['model']['markers']['get']('user:range:'+_0x40bb5d)['getRange']()['isCollapsed'])return;const _0x31862c=_0x37e03e['parent'];return _0x295fa6['model']['schema']['isLimit'](_0x31862c)&&!_0x295fa6['model']['hasContent'](_0x31862c)&&(_0x1b5196['contenteditable']=!0x1),function(_0x523fce,_0x53236c,_0x257f25){const _0x1eaad3=_0x523fce['createUIElement']('span',_0x53236c);return _0x523fce['setCustomProperty']('userPositionMarker',!0x0,_0x1eaad3),_0x1eaad3['render']=function(_0x3c4f9e){const _0x73b7f1=this['toDomElement'](_0x3c4f9e),_0x2f4b11=document['createElement']('span');return _0x2f4b11['classList']['add']('ck-user__marker-tooltip'),_0x2f4b11['setAttribute']('contenteditable','false'),_0x2f4b11['setAttribute']('spellcheck','false'),_0x2f4b11['textContent']=_0x257f25['name'],_0x73b7f1['innerHTML']='⁠<span\x20class=\x22ck-user__marker-line\x22\x20contenteditable=\x22false\x22><span\x20class=\x22ck-user__marker-dot\x22></span></span>'+_0x2f4b11['outerHTML']+'⁠',_0x73b7f1['addEventListener']('mouseenter',()=>{_0x73b7f1['classList']['add']('ck-user__marker_hovered');}),_0x73b7f1['addEventListener']('mouseleave',()=>{_0x73b7f1['classList']['remove']('ck-user__marker_hovered');}),_0x73b7f1;},_0x1eaad3['isSimilar']=function(_0x2e75ed){return!(!this['getCustomProperty']('userPositionMarker')||!_0x2e75ed['getCustomProperty']('userPositionMarker')||this['getAttribute']('data-session-id')!=_0x2e75ed['getAttribute']('data-session-id'));},_0x1eaad3;}(_0x39ee8f,_0x1b5196,_0x30cbba);}(_0x1ec39f,_0x1cedd0,_0x4a644d,_0x2b7e43)}),_0x2b7e43['conversion']['for']('editingDowncast')['markerToHighlight']({'model':'user:range','view':_0x1e4812=>function(_0xb3fbc8,_0x1257fb){const _0x3ea34e=_0xb3fbc8['markerName']['split'](':')[0x2];if(_0x3ea34e===_0x1257fb['mySessionId'])return null;const _0x53bf4f=_0x1257fb['getUserBySessionId'](_0x3ea34e);if(!_0x53bf4f)return{'id':_0x3ea34e,'classes':[]};return{'id':_0x3ea34e,'classes':['ck-user__selection',_0x53bf4f['color']['getSelectionClass']()],'attributes':{'data-session-id':_0x3ea34e},'priority':0x7d0+_0x53bf4f['orderNumber']};}(_0x1e4812,_0x4a644d)}),function(_0x381621){const _0x3589b6=_0x381621['model'],_0x43d4b7=new Map(),_0x297436=_0x381621['plugins']['get'](i);_0x3589b6['markers']['on']('update:user:range',(_0x20707d,_0x497946,_0x9a2b1a,_0x25ccfd)=>{if(!_0x25ccfd&&_0x43d4b7['get'](_0x497946['name']))return _0x43d4b7['get'](_0x497946['name'])['detach'](),void _0x43d4b7['delete'](_0x497946['name']);const _0x5a323c=_0x497946['name']['split'](':')[0x2];if(_0x5a323c===_0x297436['mySessionId'])return;const _0x366327='user:position:'+_0x5a323c;_0x3589b6['markers']['has'](_0x366327)&&_0x381621['editing']['reconvertMarker'](_0x366327),_0x497946['on']('change:range',(_0x252be9,_0x164519,_0x12a09b)=>{if('$graveyard'!=_0x164519['root']['rootName']&&'$graveyard'==_0x497946['getRange']()['root']['rootName']&&!_0x43d4b7['has'](_0x497946['name'])){const _0x283b8e=_0x3589b6['schema']['getNearestSelectionRange'](_0x12a09b['deletionPosition']);if(_0x283b8e){const _0x14442b=ht['fromRange'](_0x283b8e);_0x43d4b7['set'](_0x497946['name'],_0x14442b),_0x14442b['on']('change:range',(_0x5ea293,_0x330aaf,_0x43d7d1)=>{if('$graveyard'==_0x14442b['root']['rootName']){const _0x4e3152=_0x3589b6['schema']['getNearestSelectionRange'](_0x43d7d1['deletionPosition']);_0x4e3152?(_0x14442b['start']=_0x4e3152['start'],_0x14442b['end']=_0x4e3152['end']):(_0x43d4b7['delete'](_0x497946['name']),_0x14442b['detach']());}});}}});}),_0x3589b6['document']['on']('change',()=>{_0x43d4b7['size']>0x0&&_0x3589b6['enqueueChange']({'isUndoable':!0x1},_0x447cf0=>{for(const [_0x537a8f,_0x2eeafc]of _0x43d4b7)'$graveyard'==_0x3589b6['markers']['get'](_0x537a8f)['getRange']()['root']['rootName']&&(te(_0x537a8f['split'](':')[0x2],_0x2eeafc['toRange'](),_0x3589b6,_0x447cf0),_0x2eeafc['detach']());_0x43d4b7['clear']();});});}(_0x2b7e43),this['_domEmitter']['listenTo'](_0x22ed95['document'],'keydown',(_0x3cf23d,{key:_0x64a880})=>{'Escape'===_0x64a880&&function(_0x4a7de4){_0x4a7de4['editing']['view']['change'](_0x26a317=>{for(const _0x4f216a of _0x4a7de4['model']['markers']){if(!_0x4f216a['name']['startsWith']('user:position'))continue;const _0x1b61f0=_0x4a7de4['editing']['mapper']['markerNameToElements'](_0x4f216a['name']);if(_0x1b61f0){for(const _0x39b23d of _0x1b61f0)_0x26a317['removeClass']('ck-user__marker_hovered',_0x39b23d);}}});}(_0x2b7e43);},{'useCapture':!0x0});}['afterInit'](){const _0x41eab8=this['editor'],_0x30de5d=_0x41eab8['commands']['get']('undo');_0x30de5d&&_0x41eab8['model']['on']('applyOperation',(_0x36694f,_0x18561b)=>{const _0x9a7cfb=_0x18561b[0x0];if(!_0x9a7cfb['isDocumentOperation'])return;if('marker'!=_0x9a7cfb['type']||!_0x9a7cfb['name']['startsWith']('user:'))return;const _0x341406=_0x9a7cfb['batch'];_0x30de5d['_createdBatches']['has'](_0x341406)&&(_0x9a7cfb['newRange']=_0x9a7cfb['oldRange']?_0x41eab8['model']['createRange'](_0x9a7cfb['oldRange']['start'],_0x9a7cfb['oldRange']['end']):null);},{'priority':'highest'});}['destroy'](){return this['_domEmitter']['stopListening'](),super['destroy']();}['createUserMarkerOperations'](){const _0x5875b1=this['editor'],_0x53f4d9=_0x5875b1['model']['document'],_0x886e39=_0x5875b1['plugins']['get'](i);_0x5875b1['model']['enqueueChange']({'isUndoable':!0x1},_0x41e1f1=>{const _0x51c7a6='user:range:'+_0x886e39['mySessionId'],_0x3bcdc4='user:position:'+_0x886e39['mySessionId'],_0x4d8af4=_0x5875b1['model']['markers']['has'](_0x51c7a6);_0x5875b1['editing']['view']['hasDomSelection']?te(_0x886e39['mySessionId'],_0x53f4d9['selection']['getFirstRange'](),_0x5875b1['model'],_0x41e1f1):_0x4d8af4&&(_0x41e1f1['removeMarker'](_0x51c7a6),_0x41e1f1['removeMarker'](_0x3bcdc4));});}}function te(_0x368f21,_0x58524f,_0x613beb,_0x53b2fd){const _0x5db380='user:range:'+_0x368f21,_0x45760b='user:position:'+_0x368f21,_0x2466a6=_0x58524f['getContainedElement']();let _0x5adc65=_0x58524f['start'];_0x2466a6&&_0x2466a6['is']('element','tableCell')&&(_0x5adc65=function(_0x1e5580,_0x18d237){for(const _0x3bc569 of _0x1e5580['getPositions']())if(_0x18d237['schema']['checkChild'](_0x3bc569,'$text'))return _0x3bc569;}(_0x58524f,_0x613beb),_0x58524f=_0x53b2fd['createRange'](_0x5adc65));const _0x2a7fa1=_0x53b2fd['createRange'](_0x5adc65);_0x613beb['markers']['has'](_0x5db380)?(_0x53b2fd['updateMarker'](_0x5db380,{'range':_0x58524f}),_0x53b2fd['updateMarker'](_0x45760b,{'range':_0x2a7fa1})):(_0x53b2fd['addMarker'](_0x5db380,{'range':_0x58524f,'usingOperation':!0x0}),_0x53b2fd['addMarker'](_0x45760b,{'range':_0x2a7fa1,'usingOperation':!0x0}));}function G(_0x17f4f4,_0x4f63cc,_0xde6fd4){const _0x7dffb6=_0x17f4f4['t'],t=_0x17f4f4['t'];switch(_0x4f63cc){case'PENDING_ACTION_SENDING_DATA':return t({'string':'Sending\x20data\x20to\x20the\x20server.','id':'PENDING_ACTION_SENDING_DATA'});case'The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'Synchronization\x20issue':return t('Synchronization\x20issue');case'Connected\x20users\x20list\x20dropdown\x20menu':return t('Connected\x20users\x20list\x20dropdown\x20menu');case'Collapsed\x20connected\x20users\x20list\x20(press\x20ENTER\x20to\x20open\x20it)':return t('Collapsed\x20connected\x20users\x20list\x20(press\x20ENTER\x20to\x20open\x20it)');case'Connected\x20users\x20list':return t('Connected\x20users\x20list');case'PENDING_ACTION_REVISION_HISTORY':return _0x7dffb6({'string':'Unsaved\x20change\x20in\x20revision\x20history.','id':'PENDING_ACTION_REVISION_HISTORY'});case'CONNECTED_USERS':return t({'string':'1\x20connected\x20user\x20(me)','plural':'%0\x20connected\x20users','id':'CONNECTED_USERS'},_0xde6fd4);default:return'';}}let J=0x1;class l extends _0x325c29{static ['CollaborativeEditingService']=/* #__PURE__ -- @preserve */
((()=>_0x5cc764)());['_offset'];['sessionId'];['serverHistory'];['_channelId'];['_service'];['_document'];['_compressor'];['_bufferedOperations'];['_knownOperations'];['_knownRootNames'];['_pendingAction'];['_hasSelectionChanged'];['_sendBufferedOperationsDelayId'];['_baseBufferDelay'];['_currentBufferDelay'];['_lastSyncedOperationId'];['_disconnectionOperations'];['_operationIdentifier'];static get['requires'](){return[c,i,q,_0x4665b8,_0x14c341,_0x3ce412];}static get['pluginName'](){return'RealTimeCollaborationClient';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}get['cloudDocumentVersion'](){return this['_lastServerVersion']+this['_offset'];}get['_lastServerVersion'](){return this['serverHistory']['version']-this['_offset'];}get['lastSyncVersion'](){const _0x5b4f74=this['serverHistory']['getOperations']();for(let _0x9de944=_0x5b4f74['length']-0x1;_0x9de944>=0x0;_0x9de944--){const _0x2d6369=_0x5b4f74[_0x9de944];if(!this['_disconnectionOperations']['has'](_0x2d6369))return _0x2d6369['baseVersion']+0x1-this['_offset'];}return 0x0;}constructor(_0x49a144){if(super(_0x49a144),this['_offset']=0x0,this['sessionId']=null,this['serverHistory']=new _0x37ca4c(),this['editor']['config']['define']('collaboration',{}),this['_channelId']=this['editor']['config']['get']('collaboration.channelId'),!this['_channelId'])throw new _0x1f3dd5('collaboration-missing-channelid',this);const _0xe7f428=_0x49a144['config']['get']('cloudServices.bundleVersion')||nt;this['_service']=new l['CollaborativeEditingService'](_0xe7f428,this['_channelId']),this['_document']=this['editor']['model']['document'],this['_compressor']=new _0x42ebdd(),this['_bufferedOperations']=[],this['_knownOperations']=new WeakSet(),this['_knownRootNames']=new Set(),this['set']('_isPendingUpdate',!0x1),this['set']('_hasSynchronizationProblem',!0x1),this['_pendingAction']=null,this['_hasSelectionChanged']=!0x1,this['_sendBufferedOperationsDelayId']=null,this['_baseBufferDelay']=0x12c,this['_currentBufferDelay']=this['_baseBufferDelay'],this['_lastSyncedOperationId']=null,this['_disconnectionOperations']=new WeakSet(),this['_operationIdentifier']=new Y(this['_disconnectionOperations']);}['init'](){const _0x38b428=this['editor'],_0x2bf7b4=_0x38b428['plugins']['get'](_0x14c341),_0x1fb08a=_0x38b428['plugins']['get'](c);this['listenTo'](_0x2bf7b4,'getOperationAuthor',(_0x4468e8,_0x524af1)=>{const _0x19d014=_0x524af1[0x0];_0x19d014['_authorId']&&(_0x4468e8['return']=_0x2bf7b4['getUser'](_0x19d014['_authorId']),_0x4468e8['stop']()),null===_0x19d014['_authorId']&&(_0x4468e8['return']=null,_0x4468e8['stop']());},{'priority':'high'}),this['listenTo'](_0x38b428['model']['document']['selection'],'change:range',(_0x4d749b,_0x40489c)=>{_0x40489c['directChange']&&this['_refreshUserSelectionMarkers']();}),this['listenTo'](_0x38b428['editing']['view'],'change:hasDomSelection',()=>{this['_refreshUserSelectionMarkers']();}),this['_initThrowingOnDataSet'](),_0x38b428['model']['on']('applyOperation',(_0x5b410d,_0x2893cd)=>{const _0x3d532b=_0x2893cd[0x0];_0x3d532b['isDocumentOperation']&&(this['_saveOperationInBuffer'](_0x3d532b),this['_shouldSendUpdate']()&&this['_sendBufferedOperationsDelayed']());}),this['_setUpDataInit'](),this['bind']('_isEditingAllowed')['to'](_0x1fb08a,'state',this,'_hasSynchronizationProblem',(_0x437c4a,_0x5991bd)=>'connected'===_0x437c4a&&!_0x5991bd),this['on']('change:_isEditingAllowed',()=>{this['_isEditingAllowed']?_0x38b428['disableReadOnlyMode']('rtc-offline'):_0x38b428['enableReadOnlyMode']('rtc-offline');}),this['_isEditingAllowed']?_0x38b428['disableReadOnlyMode']('rtc-offline'):_0x38b428['enableReadOnlyMode']('rtc-offline'),this['set']('_isConnected',!0x1);}async['reconnect'](){const _0x29edf1=this['editor']['plugins']['get'](i),_0x44c19b=this['editor']['plugins']['get'](c);try{this['_isPendingUpdate']=!0x0,_0x29edf1['unregister'](this['_channelId']);const _0x1a9a69=await this['_service']['reconnect'](_0x44c19b['connection'],this['lastSyncVersion']);await this['_handleReconnectionResponse'](_0x1a9a69)&&(this['_isPendingUpdate']=!0x1,this['_clearPendingAction']());const _0x10b56b=await this['_service']['getConnectedSessions']();_0x29edf1['register'](this['_channelId'],_0x10b56b),this['_handleSendingSelectionMarkers'](),this['_isConnected']=!0x0;}catch(_0x5874ad){if(function(_0x162139){return'404'===_0x162139['code'];}(_0x5874ad)&&this['sessionId'])await this['_connectAfterSessionHasBeenFlushed']();else{if(function(_0x36f559){return'409'===_0x36f559['code'];}(_0x5874ad)){const _0x5eb1b4=G(this['editor']['locale'],'The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');this['_handleReconnectionError'](_0x5eb1b4);}else{if(!(_0x5874ad instanceof Q))throw _0x5874ad;this['_handleReconnectionError']();}}}}['destroy'](){const _0x2083c4=this['editor']['plugins']['get'](c),_0x5c5f3a=this['editor']['plugins']['get'](i);this['editor']['enableReadOnlyMode']('rtc-destroyed'),_0x5c5f3a['channelSessions']['has'](this['_channelId'])&&_0x5c5f3a['unregister'](this['_channelId']),_0x2083c4['removeFromReconnectionStack'](this),this['_disconnectService'](),super['destroy']();}async['_handleReconnectionResponse'](_0x38262e){if(this['sessionId']!==_0x38262e['sessionId']&&this['_lastSyncedOperationId']!==_0x38262e['lastOperationId'])throw new Q();return this['sessionId']=_0x38262e['sessionId'],this['_handleServerResponse']([],{..._0x38262e,'wereChangesApplied':!0x1,'data':_0x38262e['data']},'reconnect');}async['_connectService'](_0x41d373,_0x11b954=!0x1){const {connection:_0x2df5d0}=this['editor']['plugins']['get'](c);l['CollaborativeEditingService']['getConnectedSessions'](_0x2df5d0,this['_channelId'])['then'](_0x27e687=>this['_initSessionsHandling'](_0x27e687))['catch'](_0x18b0ce=>{this['_crash']('realtimecollaborationclient-init-session-connection-error',_0x18b0ce);}),this['listenTo'](this['_service'],'operationsReceived',this['_handleReceivedOperations']['bind'](this)),this['listenTo'](this['_service'],'error',(_0x2cbad0,_0x1dc475)=>{this['_crash']('realtimecollaborationclient-init-service-internal-error',_0x1dc475);}),this['listenTo'](this['_service'],'disconnected',()=>{this['_isConnected']=!0x1;});const _0x4ac98b=this['_operationIdentifier']['getIdOfTheLastOperation'](_0x41d373);this['_isPendingUpdate']=!0x0;const _0x1ecd4f=await this['_service']['connect'](_0x2df5d0,this['_compressOperations'](_0x41d373),_0x4ac98b);if(this['sessionId']=_0x1ecd4f['sessionId'],_0x11b954){if(!_0x1ecd4f['wereChangesApplied'])return void this['_handleReconnectionError']();this['_isPendingUpdate']=!0x1,this['_clearPendingAction'](),this['serverHistory']['reset'](),this['_offset']=_0x1ecd4f['offset'],this['serverHistory']['version']=this['_offset'],await this['_handleServerResponse'](_0x41d373,_0x1ecd4f,'reconnection:\x20flushed\x20session');}else await this['_handleInitialConnectionData'](_0x1ecd4f,_0x41d373);this['_handleSendingSelectionMarkers'](),this['_isConnected']=!0x0;}['_handleSendingSelectionMarkers'](){const _0x117628=this['editor']['plugins']['get'](i),_0x340bc9=this['editor']['plugins']['get'](q),_0x12c1c4=_0x117628['channelSessions']['get'](this['_channelId']);_0x12c1c4&&_0x12c1c4['length']>0x1?_0x340bc9['createUserMarkerOperations']():this['listenTo'](_0x117628,'sessionAdd:'+this['_channelId'],()=>{0x2===_0x117628['channelSessions']['get'](this['_channelId'])['length']&&_0x340bc9['createUserMarkerOperations']();});}async['_handleReceivedOperations'](_0x50045a,_0xceed93,_0x1e57b9,_0x1d056b){if(!this['_isPendingUpdate']&&this['_document']['version']==_0xceed93){const _0x19aad9=this['_decompressOperations'](_0x1e57b9,_0x1d056b);await this['_fetchMissingUsers'](_0x19aad9),this['_handleExternalOperations'](_0x19aad9,_0xceed93,_0x1e57b9['lastOperationId'])||this['_crash']('realtimecollaborationclient-init-service-incorrect-server-operation');}}async['_connectAfterSessionHasBeenFlushed'](){this['_disconnectService']();const {locale:_0x16f796}=this['editor'];let _0x1ec4a7;try{_0x1ec4a7=await this['_service']['getDocumentDetails']();}catch(_0x43e060){const _0x5aca63=G(_0x16f796,'The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');return void this['_handleReconnectionError'](_0x5aca63);}const _0x142c08=_0x1ec4a7['currentDocumentSession']||_0x1ec4a7['lastDocumentSession'];if(this['_lastSyncedOperationId']===_0x142c08['lastOperationId'])await this['_connectService'](this['editor']['model']['document']['history']['getOperations'](),!0x0);else{const _0x5ecdce=G(_0x16f796,'The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');this['_handleReconnectionError'](_0x5ecdce);}}['_disconnectService'](){this['_service']['disconnect'](),this['_bufferedOperations']=[],clearTimeout(this['_sendBufferedOperationsDelayId']),this['stopListening'](this['_service']);}['_initSessionsHandling'](_0x1b4721){const _0xfc4441=this['editor']['plugins']['get'](i);this['listenTo'](_0xfc4441,'sessionAdd:'+this['_channelId'],(_0xd52256,{session:_0x5a7840})=>{if(_0x5a7840['id']===_0xfc4441['mySessionId']){_0xd52256['off']();const _0x44c5ab=this['editor']['plugins']['has']('CommentsOnly')&&this['editor']['plugins']['get']('CommentsOnly');let _0x397b3f=_0x5a7840['permissions'];_0x44c5ab&&_0x44c5ab['isEnabled']&&(_0x397b3f=_0x397b3f['filter'](_0x50d492=>'document:write'!==_0x50d492)),this['editor']['plugins']['get']('Permissions')['setPermissions'](_0x397b3f,this['_channelId']);}}),_0xfc4441['register'](this['_channelId'],_0x1b4721);}['_initThrowingOnDataSet'](){const _0x28fdd8=this['editor']['data']['set'];this['editor']['data']['set']=(..._0x596881)=>{if(!_0x596881[_0x596881['length']-0x1]['suppressErrorInCollaboration'])throw new _0x1f3dd5('realtimecollaborationclient-editor-setdata-and-editor-data-set-are-forbidden-in-real-time-collaboration',this);_0x28fdd8['apply'](this['editor']['data'],_0x596881);};}['_setUpDataInit'](){this['editor']['data']['on']('init',(_0x3d746a,[_0x312902])=>{if(this['_document']['version'])throw new _0x1f3dd5('realtimecollaborationclient-init-document-already-initialized',this);_0x3d746a['stop'](),this['_setPendingAction']();const _0x262f3c=this['editor']['config']['get']('rootsAttributes'),_0x3eac0f=this['_getOperationsFromInitData'](_0x312902,_0x262f3c);0x0==_0x3eac0f['length']&&_0x3eac0f['push'](new _0x4a9ec7(0x0)),_0x3d746a['return']=this['_connectService'](_0x3eac0f)['then'](()=>{this['editor']['plugins']['get'](c)['addToReconnectionStack'](this),this['editor']['data']['fire']('ready');})['catch'](_0x23d435=>this['_crash']('realtimecollaborationclient-init-connection-failed',_0x23d435))['finally'](()=>this['_clearPendingAction']());},{'priority':'high'}),this['editor']['on']('loadRoot',async(_0x2f96a9,[_0x35ce92,_0x5c27cb])=>{_0x2f96a9['stop']();const _0x11adfc=this['editor']['model']['document']['getRoot'](_0x35ce92);if(!this['_knownRootNames']['has'](_0x35ce92)){const _0x377680=_0x5c27cb&&_0x5c27cb['data']?_0x5c27cb['data']:'',_0x13cc30=_0x5c27cb&&_0x5c27cb['attributes']?_0x5c27cb['attributes']:{};await this['_loadRoot'](_0x35ce92,_0x377680,_0x13cc30);}this['editor']['model']['enqueueChange']({'isUndoable':!0x1},()=>{_0x11adfc['_isLoaded']=!0x0,this['editor']['model']['document']['differ']['_bufferRootLoad'](_0x11adfc);});},{'priority':'high'});}async['_fetchMissingUsers'](_0x4c66f0){const _0x5460aa=this['editor']['plugins']['get'](_0x14c341),{connection:_0x2b6d66}=this['editor']['plugins']['get'](c),_0x5b2d24=new Set();for(const _0x593479 of _0x4c66f0){const _0x1668e9=_0x593479['_authorId'];_0x1668e9&&!_0x5460aa['getUser'](_0x1668e9)&&_0x5b2d24['add'](_0x1668e9);}if(0x0===_0x5b2d24['size'])return;const _0x5e97df=await dt['getMany'](_0x2b6d66,Array['from'](_0x5b2d24));for(const _0x49f96d of _0x5e97df)_0x5460aa['getUser'](_0x49f96d['id'])||_0x5460aa['addUser'](_0x49f96d);}['_getOperationsFromInitData'](_0x55c36b,_0x11c572={}){const _0x4b03d1=this['editor']['model'],_0x3ae505=[];let _0x4bec2a=0x0;const _0x4c976c='string'==typeof _0x55c36b?{'main':_0x55c36b}:_0x55c36b;for(const _0x4aa681 of Object['keys'](_0x4c976c)){if(!this['_document']['roots']['has'](_0x4aa681))throw new _0x1f3dd5('realtimecollaborationclient-init-non-existent-root',this);const _0x5e9996=this['editor']['data']['parse'](_0x4c976c[_0x4aa681]),_0x3a118e=this['_document']['getRoot'](_0x4aa681),_0x35859e=new _0x275bde(_0x4b03d1['createPositionAt'](_0x3a118e,0x0),_0x5e9996,_0x4bec2a++);_0x3ae505['push'](_0x35859e);for(const [_0x10a1db,_0x48db26]of _0x5e9996['markers']){const _0x3ebc26=_0x4b03d1['createRange'](_0x4b03d1['createPositionFromPath'](_0x3a118e,_0x48db26['start']['path']['slice']()),_0x4b03d1['createPositionFromPath'](_0x3a118e,_0x48db26['end']['path']['slice']())),_0x377348=new _0x36e6fd(_0x10a1db,null,_0x3ebc26,_0x4b03d1['markers'],!0x0,_0x4bec2a++);_0x3ae505['push'](_0x377348);}}if(_0x11c572)for(const [_0x1ab2de,_0x114306]of Object['entries'](_0x11c572)){const _0x40c8c7=_0x4b03d1['document']['getRoot'](_0x1ab2de);if(!_0x40c8c7)throw new _0x1f3dd5('multi-root-editor-root-attributes-no-root',null);for(const [_0x14bfa2,_0x526bfe]of Object['entries'](_0x114306))if(null!==_0x526bfe){const _0x534512=new _0x55f2ce(_0x40c8c7,_0x14bfa2,null,_0x526bfe,_0x4bec2a++);_0x3ae505['push'](_0x534512);}}return _0x3ae505;}async['_loadRoot'](_0x4fca84,_0x488170,_0x44614f){this['_getOperationsFromInitData']({[_0x4fca84]:_0x488170},{[_0x4fca84]:_0x44614f})['forEach']((_0xa99a00,_0x47f079)=>{_0xa99a00['baseVersion']=this['_document']['version']+_0x47f079,_0xa99a00['_isInit']=!0x0,this['_saveOperationInBuffer'](_0xa99a00);}),this['_sendBufferedOperationsDelayed'](),await this['_waitUntilSynced']();}async['_handleInitialConnectionData'](_0x132905,_0x4412c2){let _0x5ea64e;this['_offset']=_0x132905['offset'];const _0xdfc856=_0x132905['wereChangesApplied']&&!_0x132905['initData'],_0x329d6f=_0xdfc856?0x0:_0x132905['data']['baseVersion'];if(_0x4412c2['forEach'](_0x1dcbe0=>{_0x1dcbe0['_isInit']=!0x0,_0x1dcbe0['createdAt']=_0x132905['sessionCreatedAt'],_0x1dcbe0['_authorId']=null;}),_0xdfc856)_0x5ea64e=_0x4412c2,this['_applyOperationsSet'](_0x5ea64e,_0xdfc856);else{if(_0x132905['initData']){const _0x1955b1=this['_getOperationsFromInitData'](_0x132905['initData']);this['_document']['history']['version']=-_0x1955b1['length'],_0x1955b1['forEach'](_0x3fce87=>{_0x3fce87['baseVersion']-=_0x1955b1['length'],_0x3fce87['createdAt']=_0x132905['sessionCreatedAt'],_0x3fce87['_isInit']=!0x0,_0x3fce87['_authorId']=null;}),this['_applyOperationsSet'](_0x1955b1,!0x0),this['serverHistory']['version']=-_0x1955b1['length']+this['_offset'],this['_updateServerHistory'](_0x1955b1);}this['_document']['history']['version']=_0x329d6f,_0x5ea64e=this['_decompressOperations'](_0x132905['data'],_0x132905['metadata']),await this['_fetchMissingUsers'](_0x5ea64e),this['_applyOperationsSet'](_0x5ea64e,_0xdfc856);}_0x132905['lastOperationId']&&(this['_operationIdentifier']['setIdForTheLastOperation'](_0x5ea64e,_0x132905['lastOperationId']),this['_lastSyncedOperationId']=_0x132905['lastOperationId']),this['serverHistory']['version']=_0x329d6f+this['_offset'],this['_updateServerHistory'](_0x5ea64e),_0x4412c2['filter'](_0xf63758=>{const _0x100eb9=this['_getAffectedRoot'](_0xf63758);return _0x100eb9&&!this['_knownRootNames']['has'](_0x100eb9);})['forEach']((_0x36b845,_0x3e9ef4)=>{_0x36b845['baseVersion']=this['_document']['version']+_0x3e9ef4,this['_saveOperationInBuffer'](_0x36b845);}),this['_shouldSendUpdate']()?(this['_currentBufferDelay']=0x0,this['_sendBufferedOperationsDelayed'](!0x0),await this['_waitUntilSynced']()):(this['_isPendingUpdate']=!0x1,this['_clearPendingAction']());}['_crash'](_0x5c9bdf,_0x35b2e3){const _0x478aac=_0x35b2e3&&_0x35b2e3['message'];if(_0x478aac&&_0x478aac['startsWith']('realtimecollaborationclient'))throw _0x35b2e3;const _0x500516=this['editor']['plugins']['get'](c);throw this['_isPendingUpdate']=!0x0,_0x500516['disconnect'](),this['editor']['enableReadOnlyMode']('realtimecollaborationclient-error'),new _0x1f3dd5(_0x5c9bdf,this['editor'],_0x478aac?{'originalError':_0x478aac}:void 0x0);}['_saveOperationInBuffer'](_0x49c8a5){this['_knownOperations']['has'](_0x49c8a5)||(this['_knownOperations']['add'](_0x49c8a5),this['_bufferedOperations']['push'](_0x49c8a5),this['_pendingAction']||'marker'==_0x49c8a5['type']&&!_0x49c8a5['affectsData']||this['_setPendingAction']());}['_sendBufferedOperationsDelayed'](_0x513833=!0x1){!_0x513833&&this['_isPendingUpdate']||(this['_isPendingUpdate']=!0x0,clearTimeout(this['_sendBufferedOperationsDelayId']),this['_sendBufferedOperationsDelayId']=setTimeout(()=>{this['_sendBufferedOperations']()['then'](_0x3d85b5=>{_0x3d85b5&&(this['_clearPendingAction'](),this['_isPendingUpdate']=!0x1);})['catch'](_0x5b9d22=>{this['_clearPendingAction'](),this['_isPendingUpdate']=!0x1,function(_0x389fb1){return _0x389fb1['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x389fb1['message']['startsWith']('cloud-services-internal-error:\x20Collaborative\x20Editing\x20Service\x20is\x20not\x20connected.')||_0x389fb1['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}(_0x5b9d22)||this['_crash'](_0x5b9d22['message'],_0x5b9d22);});},this['_currentBufferDelay']));}['_waitUntilSynced'](){return new Promise(_0x2e592c=>{this['on']('change:_isPendingUpdate',()=>{_0x2e592c();});});}async['_sendBufferedOperations'](){const _0x51467e=this['editor']['plugins']['get'](q);if(this['_shouldSendSelectionUpdate']()&&(_0x51467e['createUserMarkerOperations'](),this['_hasSelectionChanged']=!0x1),!this['_shouldSendUpdate']())return!0x0;const _0x52e0a3=[...this['_bufferedOperations']];for(const _0x12a3e1 of _0x52e0a3)_0x12a3e1['wasUndone']=this['_document']['history']['isUndoneOperation'](_0x12a3e1);const _0x12b659=this['_operationIdentifier']['getIdOfTheLastOperation'](_0x52e0a3),_0x3b887a=J++,_0x26eac8=this['_compressOperations'](_0x52e0a3),_0x2b33da=await this['_service']['sendOperations'](_0x26eac8,_0x26eac8['baseVersion'],_0x12b659);try{return await this['_handleServerResponse'](_0x52e0a3,_0x2b33da,_0x3b887a);}catch(_0x520126){return this['_crash']('realtimecollaborationclient-sendbufferedoperations',_0x520126);}}async['_handleServerResponse'](_0x55b203,_0x246ba9,_0x175f91){if('error'in _0x246ba9)throw _0x246ba9['error'];let _0x1c7a0e=!0x1;if(_0x246ba9['wereChangesApplied']){_0x246ba9['lastOperationId']&&(this['_lastSyncedOperationId']=_0x246ba9['lastOperationId']),this['_bufferedOperations']=this['_bufferedOperations']['filter'](_0x29a883=>!_0x55b203['includes'](_0x29a883));for(const _0x75b273 of _0x55b203)_0x75b273['createdAt']='lastOperationAcceptedAt'in _0x246ba9&&_0x246ba9['lastOperationAcceptedAt']||void 0x0;X(_0x55b203,_0x246ba9['version']-_0x55b203['length']),this['_updateServerHistory'](_0x55b203);const _0x324b86=_0x55b203['filter'](_0xc7201c=>{if(!_0xc7201c['_isInit'])return!0x1;const _0x5cc547=this['_getAffectedRoot'](_0xc7201c);return _0x5cc547&&!this['_knownRootNames']['has'](_0x5cc547);});X(_0x324b86,this['_document']['version']),this['_applyOperationsSet'](_0x324b86),_0x1c7a0e=!0x0,this['_currentBufferDelay']=this['_baseBufferDelay'];}else{const _0x4aa49c=this['_decompressOperations'](_0x246ba9['data'],_0x246ba9['metadata'])['filter'](_0x2a771a=>_0x2a771a['baseVersion']>=this['_lastServerVersion']);_0x4aa49c['forEach'](_0x300cdd=>this['_addKnownRoot'](_0x300cdd)),this['_bufferedOperations']=this['_bufferedOperations']['filter'](_0x452d99=>!_0x452d99['_isInit']||!this['_knownRootNames']['has'](this['_getAffectedRoot'](_0x452d99))),this['_bufferedOperations']['length']&&X(this['_bufferedOperations'],this['_bufferedOperations'][0x0]['baseVersion']),await this['_fetchMissingUsers'](_0x4aa49c),_0x1c7a0e=this['_handleExternalOperations'](_0x4aa49c,_0x246ba9['version'],_0x246ba9['lastOperationId']),this['_currentBufferDelay']=Math['round'](this['_currentBufferDelay']/0x2);}return _0x1c7a0e?!this['_shouldSendUpdate']()||(this['_sendBufferedOperationsDelayed'](!0x0),!0x1):this['_crash']('realtimecollaborationclient-handleserverresponse');}['_handleExternalOperations'](_0x31aebd,_0x518d17,_0xa4c30d){try{const _0x16908a={'document':this['_document'],'useRelations':!0x1,'padWithNoOps':!0x0},{operationsA:_0xd1746f,operationsB:_0x3bb3ce,originalOperations:_0x366b3a}=_0x3667f8(_0x31aebd,this['_bufferedOperations'],_0x16908a);X(_0xd1746f,this['_document']['version']),X(_0x3bb3ce,_0x518d17);for(const _0x139d08 of _0xd1746f){const _0x597d4e=_0x366b3a['get'](_0x139d08);_0x139d08['_authorId']=_0x597d4e?_0x597d4e['_authorId']:null;}_0xa4c30d&&(this['_operationIdentifier']['setIdForTheLastOperation'](_0x31aebd,_0xa4c30d),this['_lastSyncedOperationId']=_0xa4c30d),this['_bufferedOperations']=[..._0x3bb3ce],this['_applyOperationsSet'](_0xd1746f),this['_updateServerHistory'](_0x31aebd);}catch(_0x2ae60c){return console['error'](_0x2ae60c),!0x1;}return!0x0;}['_applyOperationsSet'](_0x2e9fff,_0x4f6cec=!0x1){this['editor']['model']['enqueueChange']({'isUndoable':!0x1,'isLocal':!0x1},_0x28798f=>{for(const _0x5975e6 of _0x2e9fff)this['_knownOperations']['add'](_0x5975e6),this['_addKnownRoot'](_0x5975e6),_0x28798f['batch']['addOperation'](_0x5975e6),this['editor']['model']['applyOperation'](_0x5975e6);});}['_addKnownRoot'](_0x37e3f4){const _0x475ee1=this['_getAffectedRoot'](_0x37e3f4);_0x475ee1&&this['_knownRootNames']['add'](_0x475ee1);}['_getAffectedRoot'](_0xea0157){let _0x19ecdc,_0x21bcfa;switch(_0xea0157['type']){case'insert':_0x19ecdc=_0xea0157['position']['root'];break;case'marker':if(_0x21bcfa=_0xea0157['newRange'],!_0x21bcfa)return null;_0x19ecdc=_0x21bcfa['root'];break;case'addRootAttribute':_0x19ecdc=_0xea0157['root'];break;case'addRoot':_0x19ecdc=_0xea0157['affectedSelectable'];break;case'move':_0x19ecdc=_0xea0157['targetPosition']['root'];break;default:return null;}return _0x19ecdc['rootName'];}['_updateServerHistory'](_0x4bbc46){_0x4bbc46['forEach'](_0x481e56=>{const _0x4c01a1=_0x481e56['clone']();_0x4c01a1['_authorId']=_0x481e56['_authorId'],_0x4c01a1['_isInit']=!!_0x481e56['_isInit'],_0x4c01a1['createdAt']=_0x481e56['createdAt'],_0x4c01a1['baseVersion']+=this['_offset'],_0x481e56['_isDisconnection']&&this['_disconnectionOperations']['add'](_0x4c01a1),this['serverHistory']['addOperation'](_0x4c01a1);});}['_handleReconnectionError'](_0x34cad5){const _0x51721e=this['editor']['plugins']['get']('Notification'),_0x248b3f=this['editor']['locale'];_0x34cad5||(_0x34cad5=G(_0x248b3f,'The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.')),_0x51721e['showWarning'](_0x34cad5,{'title':G(_0x248b3f,'Synchronization\x20issue'),'namespace':'real-time-collaboration'}),this['_hasSynchronizationProblem']=!0x0,clearTimeout(this['_sendBufferedOperationsDelayId']),this['_bufferedOperations']=[],this['editor']['plugins']['get'](c)['disconnect']();}['_setPendingAction'](){this['_pendingAction']||(this['_pendingAction']=this['editor']['plugins']['get'](_0x4665b8)['add'](G(this['editor']['locale'],'PENDING_ACTION_SENDING_DATA')));}['_clearPendingAction'](){this['_pendingAction']&&(this['editor']['plugins']['get'](_0x4665b8)['remove'](this['_pendingAction']),this['_pendingAction']=null);}['_compressOperations'](_0x3924c5){const _0x541da5=_0x3924c5['map'](_0x33aabd=>_0x33aabd['toJSON']());return this['_compressor']['compress'](_0x541da5);}['_decompressOperations'](_0x2582b2,_0x143506){return this['_compressor']['decompress'](_0x2582b2)['map']((_0x3106ab,_0x44fb00)=>{const _0x2a6a72='init'==_0x143506[_0x44fb00]['type'];if('InsertOperation'==_0x3106ab['__className']){const _0x40fc56=_0x3106ab['position']['root'];!this['_document']['getRoot'](_0x40fc56)&&(this['_document']['createRoot']('$root',_0x40fc56)['_isAttached']=!0x1);}const _0x32091e=_0x26bbab['fromJSON'](_0x3106ab,this['_document']);return _0x32091e['wasUndone']=_0x3106ab['wasUndone'],_0x32091e['_isInit']=_0x2a6a72,_0x32091e['_authorId']=_0x2a6a72?null:_0x143506[_0x44fb00]['userId'],_0x32091e['_isDisconnection']='cs:removeUser'===_0x143506[_0x44fb00]['type'],_0x32091e['createdAt']=_0x143506[_0x44fb00]['createdAt'],_0x32091e;});}['_refreshUserSelectionMarkers'](){this['_hasSelectionChanged']=!0x0,this['_shouldSendSelectionUpdate']()?this['_sendBufferedOperationsDelayed']():this['_hasSelectionChanged']=!0x1;}['_shouldSendSelectionUpdate'](){const _0x597363=this['editor']['plugins']['get'](i)['channelSessions']['get'](this['_channelId']);return!this['editor']['isReadOnly']&&!!_0x597363&&_0x597363['length']>0x1&&this['_hasSelectionChanged'];}['_shouldSendUpdate'](){return this['_bufferedOperations']['length']>0x0||this['_shouldSendSelectionUpdate']();}}class Q extends Error{}function X(_0x5f62b6,_0xbf8a18){for(const _0x2f046b of _0x5f62b6)_0x2f046b['baseVersion']=_0xbf8a18++;}class Y{['_ignoredOperations'];['_operationToId'];constructor(_0x247682){this['_ignoredOperations']=_0x247682,this['_operationToId']=new WeakMap();}['getIdOfTheLastOperation'](_0x558aff){let _0x12c58a=_0x558aff['length'];for(;_0x12c58a--;){const _0x5ad318=_0x558aff[_0x12c58a];if(!this['_ignoredOperations']['has'](_0x5ad318)){if(!this['_operationToId']['has'](_0x5ad318)){const _0x536775=_0x3c5f05()['slice'](0x1,0x12);this['_operationToId']['set'](_0x5ad318,_0x536775);}return this['_operationToId']['get'](_0x5ad318);}}}['setIdForTheLastOperation'](_0x25ab8b,_0x4a6e10){if(!_0x4a6e10)return;let _0x3ee7cb=_0x25ab8b['length'];for(;_0x3ee7cb--;){const _0xb51e40=_0x25ab8b[_0x3ee7cb];this['_ignoredOperations']['has'](_0xb51e40)||this['_operationToId']['set'](_0xb51e40,_0x4a6e10);}}}class n extends _0x325c29{static get['requires'](){return[l];}static get['pluginName'](){return'RealTimeCollaborativeEditing';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}}class a extends _0x353ca5{static ['CommentsService']=/* #__PURE__ -- @preserve */
((()=>_0x13fd90)());['_services'];static get['requires'](){return[c,'CommentsRepository',i,_0x14c341];}static get['pluginName'](){return'CloudServicesCommentsAdapter';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}constructor(_0x38c5f3){super(_0x38c5f3),this['_services']=new Map();}async['init'](){const _0x3270f9=this['context'],_0x53bd14=_0x3270f9['plugins']['get']('CommentsRepository');if(_0x3270f9['plugins']['get'](c)['addToReconnectionStack'](this),_0x53bd14['adapter']={'addCommentThread':async({channelId:_0x435bad,threadId:_0xc9ed38,comments:_0x2bc961,resolvedAt:_0x1151bc,resolvedBy:_0x286c83,context:_0x264641,attributes:_0x256e10})=>{const _0x5b0743=await this['_getService'](_0x435bad)['addCommentThread']({'commentThreadId':_0xc9ed38,'comments':_0x2bc961['map'](_0x25c81a=>function(_0xb60128,_0x45ee35,_0xb1e16f){return{'commentThreadId':_0xb1e16f,'commentId':_0xb60128['commentId'],'userId':_0xb60128['authorId'],'content':_0xb60128['content'],'documentId':_0x45ee35,'createdAt':_0xb60128['createdAt'],'attributes':_0xb60128['attributes']||{}};}(_0x25c81a,_0x435bad,_0xc9ed38)),'resolvedAt':_0x1151bc,'resolvedBy':_0x286c83,'context':_0x264641,'attributes':_0x256e10})['catch'](ut);return{'threadId':_0x5b0743['commentThreadId'],'comments':_0x5b0743['comments']};},'getCommentThread':async({channelId:_0x5793b0,threadId:_0x5d934c})=>{const _0x354c2f=await this['_getService'](_0x5793b0)['getCommentThread'](_0x5d934c)['catch'](ut);return _0x354c2f['deletedAt']?null:(await this['_fetchMissingUsersForThreads']([_0x354c2f]),{'threadId':_0x354c2f['commentThreadId'],'comments':_0x354c2f['comments']['map'](_),'context':_0x354c2f['context'],'resolvedAt':_0x354c2f['resolvedAt'],'resolvedBy':_0x354c2f['resolvedBy'],'attributes':_0x354c2f['attributes']||{}});},'updateCommentThread':async({channelId:_0x572cf5,threadId:_0x4ced43,context:_0x4ded68,unlinkedAt:_0x47337b,attributes:_0x4a1d64})=>this['_getService'](_0x572cf5)['updateCommentThread']({'commentThreadId':_0x4ced43,'context':_0x4ded68,'attributes':_0x4a1d64,'unlinkedAt':_0x47337b})['catch'](S)['catch'](ut),'resolveCommentThread':async({channelId:_0x51b15a,threadId:_0x43b108})=>{const _0x486e8b=await this['_getService'](_0x51b15a)['resolveCommentThread'](_0x43b108)['catch'](S)['catch'](ut);return{'threadId':_0x486e8b['commentThreadId'],'resolvedAt':_0x486e8b['resolvedAt'],'resolvedBy':_0x486e8b['resolvedBy']};},'reopenCommentThread':async({channelId:_0x2079ae,threadId:_0x481962})=>this['_getService'](_0x2079ae)['reopenCommentThread'](_0x481962)['catch'](S)['catch'](ut),'removeCommentThread':({channelId:_0x5a0049,threadId:_0x170aba})=>this['_getService'](_0x5a0049)['removeCommentThread'](_0x170aba)['catch'](S)['catch'](ut),'addComment':({channelId:_0x23374a,threadId:_0x1610d4,commentId:_0x52645e,content:_0x121a8d,attributes:_0x2abe09})=>this['_getService'](_0x23374a)['addComment'](_0x1610d4,_0x52645e,_0x121a8d,_0x2abe09)['catch'](ut),'updateComment':({channelId:_0x4d6cda,threadId:_0x4c1ae8,commentId:_0x107053,content:_0x176e2d,attributes:_0x72faa9})=>this['_getService'](_0x4d6cda)['updateComment'](_0x4c1ae8,_0x107053,_0x176e2d,_0x72faa9)['catch'](S)['catch'](ut),'removeComment':({channelId:_0x135420,threadId:_0x4542bc,commentId:_0x5f4b39})=>this['_getService'](_0x135420)['removeComment'](_0x4542bc,_0x5f4b39)['catch'](S)['catch'](ut)},_0x3270f9 instanceof _0x3457e7){const _0x253ce6=_0x3270f9['config']['get']('collaboration.channelId'),_0x473a4f=_0x3270f9['plugins']['get'](i);await this['_setUpService'](_0x253ce6);const _0x70d177=await this['_services']['get'](_0x253ce6)['getConnectedSessions']();this['listenTo'](_0x473a4f,'sessionAdd:'+_0x253ce6,(_0x253f18,{session:_0x76c75})=>{_0x76c75['id']===_0x473a4f['mySessionId']&&(_0x253f18['off'](),this['context']['plugins']['get']('Permissions')['setPermissions'](_0x76c75['permissions'],_0x253ce6));}),_0x473a4f['register'](_0x253ce6,_0x70d177);}}async['_setUpService'](_0x203eea){if(this['_services']['has'](_0x203eea))throw new _0x1f3dd5('cloudservicescommentsadapter-connect-already-connected',null,{'channelId':_0x203eea});const _0x1d384e=this['context']['plugins']['get']('CommentsRepository'),_0x3bd5bb=new a['CommentsService'](_0x203eea);this['_services']['set'](_0x203eea,_0x3bd5bb),this['listenTo'](_0x3bd5bb,'commentThreadAdded',(_0x39ca22,_0x30a02f)=>{const {commentThreadId:_0x585d4f,documentId:_0x38988f,context:_0x4b276c,attributes:_0x29955b,resolvedAt:_0x70a1c9,resolvedBy:_0x14b33a,comments:_0x27114c}=_0x30a02f;_0x1d384e['getCommentThread'](_0x585d4f)||_0x1d384e['addCommentThread']({'threadId':_0x585d4f,'channelId':_0x38988f,'comments':_0x27114c?_0x27114c['map'](_):[],'context':_0x4b276c,'attributes':_0x29955b,'resolvedAt':_0x70a1c9,'resolvedBy':_0x14b33a,'isFromAdapter':!0x0});}),this['listenTo'](_0x3bd5bb,'commentThreadUpdated',(_0x3ec5cf,{commentThreadId:_0x45858a,documentId:_0x4fa541,context:_0x1ebc26,unlinkedAt:_0x3478f4,attributes:_0x218956})=>{_0x1d384e['getCommentThread'](_0x45858a)&&_0x1d384e['updateCommentThread']({'threadId':_0x45858a,'channelId':_0x4fa541,'context':_0x1ebc26,'unlinkedAt':_0x3478f4,'attributes':_0x218956,'isFromAdapter':!0x0});}),this['listenTo'](_0x3bd5bb,'commentThreadResolved',(_0x214bf5,{commentThreadId:_0x37022e,resolvedBy:_0x4c6dbd,resolvedAt:_0x171666})=>{const _0x1e8b66=_0x1d384e['getCommentThread'](_0x37022e);_0x1e8b66&&_0x1e8b66['resolve']({'resolvedBy':_0x4c6dbd,'resolvedAt':_0x171666,'isFromAdapter':!0x0});}),this['listenTo'](_0x3bd5bb,'commentThreadReopened',(_0x47f536,{commentThreadId:_0x9470f7})=>{const _0x299574=_0x1d384e['getCommentThread'](_0x9470f7);_0x299574&&_0x299574['reopen']({'isFromAdapter':!0x0});}),this['listenTo'](_0x3bd5bb,'commentThreadRemoved',(_0x47a294,{commentThreadId:_0x44d434})=>{const _0x185d0b=_0x1d384e['getCommentThread'](_0x44d434);_0x185d0b&&_0x185d0b['remove']({'isFromAdapter':!0x0});}),this['listenTo'](_0x3bd5bb,'commentAdded',(_0x232cf3,_0x266089)=>{const _0xda3d1c=_0x266089['commentThreadId'],_0x37bcc3=_0x1d384e['getCommentThread'](_0xda3d1c);_0x37bcc3&&_0x37bcc3['addComment']({..._(_0x266089),'isFromAdapter':!0x0});}),this['listenTo'](_0x3bd5bb,'commentUpdated',(_0x4a39ab,{commentThreadId:_0x2effe1,commentId:_0x53e158,content:_0x2e64e3,attributes:_0x51ee4f})=>{const _0x571fea=_0x1d384e['getCommentThread'](_0x2effe1);if(_0x571fea){const _0x4a0f47=_0x571fea['getComment'](_0x53e158);_0x4a0f47&&_0x4a0f47['update']({'content':_0x2e64e3,'attributes':_0x51ee4f,'isFromAdapter':!0x0});}}),this['listenTo'](_0x3bd5bb,'commentRemoved',(_0x1c16b5,{commentThreadId:_0x9b1cd8,commentId:_0x1ebffb})=>{const _0x1a1c34=_0x1d384e['getCommentThread'](_0x9b1cd8);if(_0x1a1c34){const _0x36099d=_0x1a1c34['getComment'](_0x1ebffb);_0x36099d&&_0x36099d['remove']({'isFromAdapter':!0x0});}}),await this['_connectService'](_0x203eea);}['destroy'](){if(this['context']instanceof _0x3457e7){const _0x373e24=this['context']['config']['get']('collaboration.channelId');this['_terminateService'](_0x373e24);}}['_terminateService'](_0x585f41){if(!this['_services']['has'](_0x585f41))throw new _0x1f3dd5('cloudservicescommentsadapter-disconnect-not-exist',null,{'channelId':_0x585f41});this['_getService'](_0x585f41)['disconnect'](),this['_services']['delete'](_0x585f41);}async['reconnect'](){for(const _0x3bcde9 of this['_services']['keys']())await this['_connectService'](_0x3bcde9);if(this['context']instanceof _0x3457e7){const _0x3a80e9=this['context']['config']['get']('collaboration.channelId'),_0x41efa3=this['context']['plugins']['get'](i);_0x41efa3['unregister'](_0x3a80e9);const _0x363c6f=await this['_services']['get'](_0x3a80e9)['getConnectedSessions']();_0x41efa3['register'](_0x3a80e9,_0x363c6f);}}async['_connectService'](_0x3e85c1){const {connection:_0x21d8eb}=this['context']['plugins']['get'](c),_0x9cf36e=this['context']['plugins']['get']('CommentsRepository'),_0x5def80=this['_services']['get'](_0x3e85c1),_0xf9f1d9=await _0x5def80['connect'](_0x21d8eb);await this['_fetchMissingUsersForThreads'](_0xf9f1d9);const _0x2ba4b7=new Set(Array['from'](_0x9cf36e['getCommentThreads']({'channelId':_0x3e85c1}),_0x4d4dc8=>_0x4d4dc8['id']));for(const _0x1b9c68 of _0xf9f1d9)_0x1b9c68['deletedAt']||_0x2ba4b7['delete'](_0x1b9c68['commentThreadId']);for(const _0x5b0cd4 of _0x2ba4b7)_0x9cf36e['getCommentThread'](_0x5b0cd4)['remove']({'isFromAdapter':!0x0});for(const _0x39edfa of _0xf9f1d9){let _0x1324df=_0x9cf36e['getCommentThread'](_0x39edfa['commentThreadId']);const {commentThreadId:_0x51b2b5,context:_0xd4fa1a,attributes:_0x521294,resolvedBy:_0x2ae7a2,resolvedAt:_0x569e6e,unlinkedAt:_0x5b7e89,deletedAt:_0x437069}=_0x39edfa;if(_0x437069)continue;_0x1324df||(_0x1324df=_0x9cf36e['addCommentThread']({'channelId':_0x3e85c1,'threadId':_0x51b2b5,'context':_0xd4fa1a,'attributes':_0x521294||{},'resolvedBy':_0x2ae7a2,'resolvedAt':_0x569e6e,'unlinkedAt':_0x5b7e89,'isFromAdapter':!0x0}));const _0x2e63ea=new Set(Array['from'](_0x1324df['comments'],_0x1d6f31=>_0x1d6f31['id']));for(const _0x42e82d of _0x39edfa['comments'])_0x2e63ea['delete'](_0x42e82d['commentId']);for(const _0x19b1d9 of _0x2e63ea)_0x1324df['getComment'](_0x19b1d9)['remove']({'isFromAdapter':!0x0});for(const _0x4ca83a of _0x39edfa['comments']){const _0x32ad58=_0x1324df['getComment'](_0x4ca83a['commentId']);_0x32ad58?_0x32ad58['content']!==_0x4ca83a['content']&&_0x32ad58['update']({'content':_0x4ca83a['content'],'isFromAdapter':!0x0}):_0x1324df['addComment'](Object['assign'](_(_0x4ca83a),{'isFromAdapter':!0x0}));}}}['_getService'](_0x1bed7f){if(!this['_services']['has'](_0x1bed7f))throw new _0x1f3dd5('cloudservicescommentsadapter-service-not-exist',null,{'channelId':_0x1bed7f});return this['_services']['get'](_0x1bed7f);}async['_fetchMissingUsersForThreads'](_0x360a5c){const _0x5dc223=this['context']['plugins']['get'](_0x14c341),{connection:_0x9d6356}=this['context']['plugins']['get'](c),_0x5b7519=new Set();for(const {resolvedBy:_0x426c95,comments:_0x16fd0f}of _0x360a5c){_0x426c95&&!_0x5dc223['getUser'](_0x426c95)&&_0x5b7519['add'](_0x426c95);for(const {userId:_0x5302ed}of _0x16fd0f)_0x5dc223['getUser'](_0x5302ed)||_0x5b7519['add'](_0x5302ed);}if(0x0===_0x5b7519['size'])return;const _0x1f93e8=await dt['getMany'](_0x9d6356,Array['from'](_0x5b7519));for(const _0x2944cf of _0x1f93e8)_0x5dc223['getUser'](_0x2944cf['id'])||_0x5dc223['addUser'](_0x2944cf);}}async function S(_0x34d618){if('404'!==_0x34d618['code'])throw _0x34d618;}function ut(_0x2154b9){if((_0x2392c5=_0x2154b9)['message']['startsWith']('cloud-services-internal-error:\x20Comments\x20Service\x20is\x20not\x20connected.')||_0x2392c5['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x2392c5['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.'))return new Promise(()=>{});var _0x2392c5;throw _0x2154b9;}function _(_0x127890){return{'threadId':_0x127890['commentThreadId'],'commentId':_0x127890['commentId'],'content':_0x127890['content'],'createdAt':_0x127890['createdAt'],'authorId':_0x127890['userId'],'attributes':_0x127890['attributes']||{}};}class f extends _0x325c29{static ['TrackChangesService']=/* #__PURE__ -- @preserve */
((()=>et)());['_bufferedRequests'];['_trackChangesService'];static get['requires'](){return[a,'TrackChangesEditing',c];}static get['pluginName'](){return'CloudServicesTrackChangesAdapter';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}constructor(_0x251de3){super(_0x251de3);const _0x59eb10=this['editor']['config']['get']('collaboration.channelId');this['_bufferedRequests']=new Map(),this['_trackChangesService']=new f['TrackChangesService'](_0x59eb10);}['init'](){const _0x1154be=this['editor']['plugins']['get'](c),_0x285a21=this['editor']['plugins']['get']('TrackChangesEditing');return _0x285a21['adapter']={'getSuggestion':async _0x5ef695=>{await this['_waitForServiceReady']();const _0x40836c=await this['_trackChangesService']['get'](_0x5ef695)['catch'](R);return await this['_fetchMissingUsersForThreads']([_0x40836c]),_0x40836c;},'addSuggestion':async({id:_0xc8f9ab,type:_0x481769,data:_0x1ff426,originalSuggestionId:_0x1ee045,attributes:_0x47547c})=>{await this['_waitForServiceReady']();const _0x1e6549={'id':_0xc8f9ab,'type':_0x481769,'data':_0x1ff426,'originalSuggestionId':_0x1ee045,'attributes':_0x47547c},_0x55ebb7=await this['_trackChangesService']['add'](_0xc8f9ab,_0x481769,_0x1ff426,_0x1ee045,_0x47547c)['catch'](_0x2e9818=>{if(ft(_0x2e9818))return new Promise(_0x447256=>{this['_bufferedRequests']['set'](_0xc8f9ab,{'resolve':_0x447256,'suggestionData':_0x1e6549});});throw _0x2e9818;});return this['_bufferedRequests']['delete'](_0xc8f9ab),_0x55ebb7;},'updateSuggestion':async(_0x3e5851,_0xc9c416)=>{if(await this['_waitForServiceReady'](),'open'!==_0xc9c416['state'])return this['_trackChangesService']['update'](_0x3e5851,_0xc9c416)['catch'](R);}},this['listenTo'](this['_trackChangesService'],'suggestionUpdated',(_0xa673a,_0x32be54)=>{_0x285a21['hasSuggestion'](_0x32be54['id'])&&(_0x285a21['getSuggestion'](_0x32be54['id'])['attributes']=_0x32be54['attributes']);}),this['_trackChangesService']['connect'](_0x1154be['connection'])['then'](_0x29dc3e=>(_0x1154be['addToReconnectionStack'](this),this['_fetchMissingUsersForThreads'](_0x29dc3e)['then'](()=>{for(const _0x21acdb of _0x29dc3e){_0x285a21['addSuggestionData'](_0x21acdb)['_saved']=!0x0;}})));}async['reconnect'](){const _0x25ce6d=this['editor']['plugins']['get']('TrackChangesEditing'),{connection:_0x29845e}=this['editor']['plugins']['get'](c),_0x2c7b94=await this['_trackChangesService']['connect'](_0x29845e);await this['_fetchMissingUsersForThreads'](_0x2c7b94);for(const {suggestionData:_0x244850,resolve:_0x2c1da7}of this['_bufferedRequests']['values']()){let _0x1e0a19=_0x2c7b94['find'](_0x2283d4=>_0x2283d4['id']===_0x244850['id']);_0x1e0a19||(_0x1e0a19=await this['_trackChangesService']['add'](_0x244850['id'],_0x244850['type'],_0x244850['data'],_0x244850['originalSuggestionId'])),_0x2c1da7(_0x1e0a19);}for(const _0xa5c812 of _0x2c7b94)_0x25ce6d['hasSuggestion'](_0xa5c812['id'])||_0x25ce6d['addSuggestionData'](_0xa5c812);}async['_waitForServiceReady'](){this['_trackChangesService']['isConnected']||await new Promise(_0x519ba7=>{this['listenTo'](this['_trackChangesService'],'connected',_0x2547ba=>{_0x2547ba['off'](),_0x519ba7();});});}async['_fetchMissingUsersForThreads'](_0x70ad96){const _0x599edf=this['editor']['plugins']['get'](_0x14c341),{connection:_0x5da0ac}=this['editor']['plugins']['get'](c),_0x560d1a=new Set();for(const {authorId:_0x483bcc}of _0x70ad96)_0x599edf['getUser'](_0x483bcc)||_0x560d1a['add'](_0x483bcc);if(0x0===_0x560d1a['size'])return;const _0x573438=await dt['getMany'](_0x5da0ac,Array['from'](_0x560d1a));for(const _0x1fd391 of _0x573438)_0x599edf['getUser'](_0x1fd391['id'])||_0x599edf['addUser'](_0x1fd391);}}function R(_0x9fb511){if(ft(_0x9fb511))return new Promise(()=>{});throw _0x9fb511;}function ft(_0x1b3199){return _0x1b3199['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x1b3199['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}class m extends _0x325c29{static get['requires'](){return['Comments',a,n,c];}static get['pluginName'](){return'RealTimeCollaborativeComments';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}['init'](){const _0x236850=this['editor']['plugins']['get'](c),_0x17f145=this['editor']['plugins']['get']('CommentsEditing'),_0x4449a3=this['editor']['plugins']['get'](a);return this['editor']['data']['once']('ready',()=>{this['listenTo'](_0x236850,'change:state',(_0x1e04c9,_0x460c25,_0x1e7078)=>{_0x17f145['isThreadsLoadingPaused']='connected'!==_0x1e7078;});}),this['listenTo'](_0x236850,'change:state',(_0x3b6ee8,_0x38ef3e,_0x5e0c8e)=>{this['editor']['plugins']['get']('CommentsRepository')['switchReadOnly']('connected'!==_0x5e0c8e);}),_0x4449a3['_setUpService'](this['editor']['config']['get']('collaboration.channelId'));}['destroy'](){this['editor']['plugins']['get'](a)['_terminateService'](this['editor']['config']['get']('collaboration.channelId')),super['destroy']();}}class p extends _0x325c29{static get['requires'](){return[m,f,'TrackChanges'];}static get['pluginName'](){return'RealTimeCollaborativeTrackChanges';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}}class u extends _0x325c29{static ['RevisionHistoryService']=/* #__PURE__ -- @preserve */
((()=>it)());['_lastRequestId'];['_revisionTracker'];['_revisionHistoryService'];['_oldOffset'];static get['requires'](){return[c,l,'RevisionHistory',i,_0x14c341];}static get['pluginName'](){return'CloudServicesRevisionHistoryAdapter';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}constructor(_0x346fa0){super(_0x346fa0);const _0x4f99c7=this['editor']['config']['get']('collaboration.channelId');this['_lastRequestId']=null,this['_revisionTracker']=this['editor']['plugins']['get']('RevisionTracker'),this['_revisionHistoryService']=new u['RevisionHistoryService'](_0x4f99c7);}async['init'](){const _0x2294e4=this['editor']['plugins']['get'](l),_0x40bb63=_0x2294e4['serverHistory'],_0x3bef76=this['editor']['plugins']['get'](c);this['_revisionTracker']['setSource']({'history':_0x40bb63,'getLatestVersion':()=>this['_getLatestVersion'](),'getCurrentRevisionId':()=>_0x2294e4['sessionId']});const _0x336d9c=this['editor']['config']['get']('cloudServices.bundleVersion')||nt,_0x1c78fa=await tt['isBundleUploaded'](_0x3bef76['connection'],_0x336d9c);this['editor']['plugins']['get']('RevisionHistory')['adapter']={'getRevision':async({revisionId:_0x16c8f5})=>(await this['_waitForServiceReady'](),await this['_revisionHistoryService']['getRevision'](_0x16c8f5)),'updateRevisions':async _0x50939c=>{await this['_waitForServiceReady']();const _0xf7da4d=this['_revisionTracker']['currentRevision'];if(_0x1c78fa&&0x1===_0x50939c['length']&&_0x50939c[0x0]['id']===_0xf7da4d['id'])return _0x50939c;for(const _0x4e9dd5 of _0x50939c)_0x4e9dd5['id']===_0xf7da4d['id']&&(_0x4e9dd5['isEmptyCurrent']=_0x4e9dd5['fromVersion']===_0x4e9dd5['toVersion']);return this['_revisionHistoryService']['updateRevisions'](_0x50939c,this['_lastRequestId'])['then'](_0x3c4ecf=>(this['_lastRequestId']=_0x3c4ecf,_0x50939c))['catch'](_0x2a9fe7=>{if(st(_0x2a9fe7)||'400'===_0x2a9fe7['code']&&void 0x0!==_0x2a9fe7['data']['wrongRequestId']){for(const _0x5f4152 of _0x50939c){!this['_revisionTracker']['repository']['getRevision'](_0x5f4152['id'])||this['_revisionTracker']['_bufferUpdate'](_0x5f4152['id'],_0x5f4152,!0x1);}if(st(_0x2a9fe7))throw _0x2a9fe7;return _0x50939c;}throw _0x2a9fe7;});}},this['listenTo'](this['_revisionHistoryService'],'revisionsUpdated',(_0x60b226,{revisionsData:_0x9cde99,requestId:_0xf137e8})=>{Math['max'](..._0x9cde99['map'](_0x42773c=>_0x42773c['toVersion']))>this['_getLatestVersionFromServerOperations']()-0x1?this['_getLatestVersion']()['then'](()=>{this['_handleRevisionsUpdate'](_0x9cde99,_0xf137e8);}):this['_handleRevisionsUpdate'](_0x9cde99,_0xf137e8);});const {revisions:_0x3d95e2,requestId:_0x16986e}=await this['_revisionHistoryService']['connect'](_0x3bef76['connection']);_0x3bef76['addToReconnectionStack'](this),this['_lastRequestId']=_0x16986e,await this['_fetchMissingUsers'](_0x3d95e2);for(const _0x2a97f5 of _0x3d95e2)this['_revisionTracker']['addRevisionData'](_0x2a97f5);this['listenTo'](_0x2294e4,'change:_isConnected',(_0x3e9eda,_0x17a7f7,_0x2ff3ed)=>{_0x2ff3ed&&(this['_oldOffset']=_0x2294e4['_offset'],_0x3e9eda['off']());}),this['_revisionTracker']['bind']('isEnabled')['to'](_0x3bef76,'state',_0x41fb3d=>_0x41fb3d===_0x281a71['CONNECTED']);}async['reconnect'](){const _0x4aacdd=this['editor']['plugins']['get'](c),_0x4daef0=this['editor']['plugins']['get'](l),_0x2e1abd=async()=>{const _0x2ce02b=this['_revisionTracker']['currentRevision'],_0x52e61d=_0x2ce02b['id'],_0x24c096=_0x52e61d!==_0x4daef0['sessionId'];if(_0x24c096){const _0x14f9e4=_0x4daef0['_offset']-this['_oldOffset'],_0x2c4d95=this['_getLatestVersionFromServerOperations']();this['_revisionTracker']['_revisionDataBuilder']['reInit']();if(_0x2ce02b['toVersion']+_0x14f9e4!==_0x2c4d95){const _0x2c4f16=_0x2ce02b['fromVersion']+_0x14f9e4,_0x46171a=this['editor']['plugins']['get'](_0x14c341),_0x4c089b=this['_revisionTracker']['buildRevisionData']({'revision':_0x2ce02b,'from':_0x2c4f16,'to':_0x2c4d95});_0x4c089b['id']=_0x2ce02b['id'];const _0x9fef4c=_0x4c089b['authorsIds']['map'](_0x3d4af1=>_0x46171a['getUser'](_0x3d4af1));_0x2ce02b['_update']({..._0x4c089b,'authors':_0x9fef4c},!0x0),this['_revisionTracker']['_bufferUpdate'](_0x2ce02b['id'],_0x4c089b,!0x0);}this['_revisionTracker']['_startingVersion']=_0x2c4d95,(_0x2ce02b['toVersion']===_0x2ce02b['fromVersion']&&!this['_revisionTracker']['_bufferedUpdates']['has'](_0x52e61d)&&this['_revisionTracker']['repository']['_revisions']['remove'](_0x52e61d),this['_revisionTracker']['_createCurrentRevision'](_0x2c4d95));}const {revisions:_0x44dabb,requestId:_0x458af0}=await this['_revisionHistoryService']['reconnect'](_0x4aacdd['connection'],this['_lastRequestId']);_0x24c096&&_0x44dabb['length']>0x0?_0x4daef0['_handleReconnectionError']():(await this['_fetchMissingUsers'](_0x44dabb),this['_handleRevisionsUpdate'](_0x44dabb,_0x458af0),this['_revisionTracker']['sendBufferedUpdates']());};return _0x4daef0['_isConnected']?_0x2e1abd():new Promise((_0x15550c,_0x1a7a51)=>{_0x4daef0['once']('change:_isConnected',()=>{_0x2e1abd()['then'](_0x15550c)['catch'](_0x1a7a51);});});}['destroy'](){super['destroy']();}async['_waitForServiceReady'](){this['_revisionHistoryService']['isConnected']||await new Promise(_0x49a9cd=>{this['listenTo'](this['_revisionHistoryService'],'connected',_0x18e9d8=>{_0x18e9d8['off'](),_0x49a9cd();});});}['_getLatestVersionFromServerOperations'](){const _0x25ee3e=this['editor']['plugins']['get'](l)['serverHistory']['getOperations']()['reverse']();for(const _0x585c56 of _0x25ee3e)if('marker'!==_0x585c56['type']||_0x585c56['affectsData'])return _0x585c56['baseVersion']+0x1;}['_getLatestVersion'](){const _0x12e2c9=this['editor']['plugins']['get'](l);return new Promise(_0x5002e7=>{_0x12e2c9['_isPendingUpdate']?_0x12e2c9['once']('change:_isPendingUpdate',()=>{_0x5002e7(this['_getLatestVersionFromServerOperations']());}):_0x5002e7(this['_getLatestVersionFromServerOperations']());});}['_handleRevisionsUpdate'](_0x5863a0,_0x271d8b){const _0x3301e2=this['_revisionTracker']['repository'];this['_lastRequestId']=_0x271d8b;for(const _0x59503b of _0x5863a0){const _0xec72cd=_0x3301e2['getRevision'](_0x59503b['id']);if(_0xec72cd){if((_0x59503b['fromVersion']||_0x59503b['toVersion'])&&(_0x59503b['diffData']=null),_0xec72cd===this['_revisionTracker']['currentRevision']){const _0x3c6977=Math['max'](_0xec72cd['toVersion'],_0x59503b['toVersion']),_0x3c82c7=Math['max'](_0xec72cd['fromVersion'],_0x59503b['fromVersion']);let _0x188239;_0xec72cd['toVersion']===_0x59503b['toVersion']&&_0xec72cd['fromVersion']===_0x59503b['fromVersion']?(_0x188239=!0x0,this['_preventResendingRevisionData'](_0x59503b)):_0x59503b['toVersion']===_0x3c6977&&_0x59503b['fromVersion']===_0x3c82c7?_0x188239=!0x1:(_0xec72cd['toVersion']===_0x3c6977&&_0xec72cd['fromVersion']===_0x3c82c7||this['_fixRevision']({'revision':_0xec72cd,'from':_0x3c82c7,'to':_0x3c6977}),_0x188239=!0x0),_0x188239&&(delete _0x59503b['fromVersion'],delete _0x59503b['toVersion'],delete _0x59503b['diffData'],delete _0x59503b['createdAt'],delete _0x59503b['authorsIds']);}this['_revisionTracker']['setRevisionData'](_0x59503b),this['_preventResendingRevisionData'](_0x59503b);}else this['_revisionTracker']['addRevisionData'](_0x59503b);}const _0x42bbb2=_0x3301e2['getRevisions']();_0x42bbb2['reverse']();for(let _0x4956ac=0x0;_0x4956ac<_0x42bbb2['length']-0x1;_0x4956ac++){const _0x34b76f=_0x42bbb2[_0x4956ac],_0x364c62=_0x42bbb2[_0x4956ac+0x1];if(_0x34b76f['fromVersion']<_0x364c62['toVersion']){const _0x2243ba=_0x364c62['toVersion'],_0x4bc5d1=Math['max'](_0x2243ba,_0x34b76f['toVersion']);this['_fixRevision']({'revision':_0x34b76f,'from':_0x2243ba,'to':_0x4bc5d1});}}}['_fixRevision']({revision:_0x36fd8f,from:_0x325a8f,to:_0x29706a}={}){const _0x1768d4=this['editor']['plugins']['get'](_0x14c341),_0x3e96c7=this['_revisionTracker']['buildRevisionData']({'revision':_0x36fd8f,'from':_0x325a8f,'to':_0x29706a});_0x3e96c7['authors']=_0x3e96c7['authorsIds']['map'](_0x5174b4=>_0x1768d4['getUser'](_0x5174b4)),_0x36fd8f['_update'](_0x3e96c7);}['_preventResendingRevisionData'](_0x4a4f0b){const _0x227324={};_0x227324['id']=_0x4a4f0b['id'];for(const _0x249a47 of Object['keys'](_0x4a4f0b))'id'!==_0x249a47&&(_0x227324[_0x249a47]=void 0x0);this['_revisionTracker']['_bufferUpdate'](_0x227324['id'],_0x227324,!0x0);}async['_fetchMissingUsers'](_0x45f1eb){const _0x1a0eea=this['editor']['plugins']['get'](_0x14c341),{connection:_0x149aba}=this['editor']['plugins']['get'](c),_0x51573a=new Set();for(const _0x2eb096 of _0x45f1eb){for(const _0x17d33a of _0x2eb096['authorsIds'])_0x544e9f(_0x17d33a);_0x2eb096['creatorId']&&_0x544e9f(_0x2eb096['creatorId']);}if(0x0===_0x51573a['size'])return;const _0x4c50f2=await dt['getMany'](_0x149aba,Array['from'](_0x51573a));for(const _0x396ac9 of _0x4c50f2)_0x1a0eea['getUser'](_0x396ac9['id'])||_0x1a0eea['addUser'](_0x396ac9);function _0x544e9f(_0x5e4c1e){_0x1a0eea['getUser'](_0x5e4c1e)||_0x51573a['add'](_0x5e4c1e);}}}function st(_0x354098){return _0x354098['message']['startsWith']('cloud-services-internal-error:\x20Revision\x20History\x20Service\x20is\x20not\x20connected.')||_0x354098['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x354098['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}class g extends _0x325c29{static get['requires'](){return['RevisionHistory',u,n];}static get['pluginName'](){return'RealTimeCollaborativeRevisionHistory';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}}class A extends _0x314b86{['_collapseAt'];constructor(_0x212be6,_0x1ed509=0x6){super(_0x212be6);const _0x145d3b=this['bindTemplate'];this['set']('isHidden',!0x0),this['set']('usersCount',0x0),this['_collapseAt']=_0x1ed509,this['bind']('isHidden')['to'](this,'usersCount',_0x53dadd=>_0x53dadd<_0x1ed509),this['setTemplate']({'tag':'div','attributes':{'class':['ck','ck-presence-list__list-item',_0x145d3b['if']('isHidden','ck-presence-list__counter--hidden')],'role':'listitem'},'children':[{'tag':'div','attributes':{'class':['ck','ck-presence-list__users-counter']},'children':[{'tag':'div','attributes':{'class':['ck','ck-presence-list__users-counter__text']},'children':[{'text':_0x145d3b['to']('usersCount',_0x3b83e8=>'+'+(_0x3b83e8-this['_collapseAt']+0x2)['toString']())}]}]}]});}}class ts extends _0x314b86{['items'];['keystrokes'];constructor(_0x1980a1){super(_0x1980a1);const _0x1eaa69=this['bindTemplate'];this['items']=this['createCollection'](),this['keystrokes']=new _0x43ab47(),this['set']({'hasPopup':!0x1,'isExpanded':!0x1}),this['setTemplate']({'tag':'div','attributes':{'aria-haspopup':_0x1eaa69['if']('hasPopup'),'aria-expanded':_0x1eaa69['to']('isExpanded',_0x4526eb=>this['hasPopup']&&String(_0x4526eb)),'aria-label':_0x1eaa69['to']('hasPopup',_0x489ed7=>G(_0x1980a1,_0x489ed7?'Collapsed\x20connected\x20users\x20list\x20(press\x20ENTER\x20to\x20open\x20it)':'Connected\x20users\x20list')),'role':'list','tabindex':_0x1eaa69['to']('hasPopup',_0x3b7b0e=>!!_0x3b7b0e&&0x0),'class':['ck','ck-presence-list__list']},'children':this['items'],'on':{'mouseenter':_0x1eaa69['to'](()=>this['fire']('presencelist:show')),'mouseleave':_0x1eaa69['to'](_0x4538ab=>{const _0x4c4543=_0x4538ab,_0x5317f8=document['querySelector']('.ck-presence-list__dropdown-list'),_0x260d3c=document['querySelector']('.ck-balloon-panel_with-arrow');_0x5317f8?.['contains'](_0x4c4543['relatedTarget'])||_0x260d3c?.['contains'](_0x4c4543['relatedTarget'])||this['fire']('presencelist:hide');})}}),this['on']('change:hasPopup',(_0xb6fbf2,_0x3cd177,_0x4b3e4d)=>{this['element']&&(_0x4b3e4d?this['element']['setAttribute']('aria-expanded',String(this['isExpanded'])):this['element']['removeAttribute']('aria-expanded'));});}['focus'](){this['element']['focus']();}['render'](){super['render'](),this['keystrokes']['listenTo'](this['element']);}}class j extends _0x314b86{['counterView'];['inlineListView'];constructor(_0x19485c,_0x2f8337=0x6){super(_0x19485c);const _0x1f0c62=this['bindTemplate'];this['set']('isCollapsed',!0x0),this['counterView']=new A(this['locale'],_0x2f8337),this['inlineListView']=new ts(_0x19485c),this['inlineListView']['bind']('hasPopup')['to'](this,'isCollapsed'),this['listenTo'](this['inlineListView']['items'],'change',()=>{for(const _0x389a6d of this['inlineListView']['items'])_0x389a6d['tooltipPosition']='s';this['inlineListView']['items']['first']&&(this['inlineListView']['items']['first']['tooltipPosition']='se');}),this['setTemplate']({'tag':'div','attributes':{'class':['ck','ck-presence-list','ck-reset','ck-rounded-corners',_0x1f0c62['if']('isCollapsed','ck-presence-list--collapsed')]},'children':[this['inlineListView']]});}}class x extends _0x314b86{['listWrapperView'];constructor(_0x1f0e10,_0x27bb01){super(_0x1f0e10);const _0x162e3d=this['bindTemplate'];this['listWrapperView']=new mt(_0x1f0e10,_0x27bb01),this['setTemplate']({'tag':'div','attributes':{'tabindex':-0x1,'role':'application','class':['ck','ck-presence-list__dropdown-list'],'aria-label':G(_0x1f0e10,'Connected\x20users\x20list\x20dropdown\x20menu')},'children':[this['listWrapperView']],'on':{'mouseleave':_0x162e3d['to'](_0x35e5d4=>{const _0x53cb04=_0x35e5d4,_0x349e83=document['querySelector']('.ck-presence-list__list'),_0xbe0ea1=document['querySelector']('.ck-balloon-panel_with-arrow');_0x349e83?.['contains'](_0x53cb04['relatedTarget'])||_0xbe0ea1?.['contains'](_0x53cb04['relatedTarget'])||this['fire']('presencelist:hide');})}});}}class mt extends _0x1a6b86{constructor(_0x14a393,_0x346570){super(_0x14a393);const _0x2eb112=this['bindTemplate'];this['set']('_isScrollable',!0x1),this['setTemplate']({'tag':_0x346570?'div':'ul','attributes':{'class':['ck','ck-reset','ck-list','ck-presence-list__dropdown-list-wrapper',_0x2eb112['if']('_isScrollable','ck-presence-list__dropdown-list-wrapper_scrollable')],'role':_0x2eb112['to']('role'),'aria-label':_0x2eb112['to']('ariaLabel'),'aria-labelledby':_0x2eb112['to']('ariaLabelledBy')},'children':this['items']}),this['listenTo'](_0x22ed95['window'],'resize',()=>this['checkIfScrollable']()),this['items']['on']('change',()=>this['checkIfScrollable']());}['render'](){super['render'](),this['checkIfScrollable']();}['checkIfScrollable'](){const _0x29f2f9=this['element'];_0x29f2f9&&(this['_isScrollable']=Math['max'](_0x29f2f9['scrollHeight'],_0x29f2f9['clientHeight'])>0.8*window['innerHeight']);}}class k extends rt{['userView'];constructor(_0x2e1990,_0x1cb5b4,_0x7b1a9f){super(_0x2e1990);const _0x1cfb3d=this['bindTemplate'];this['userView']=new ct(_0x2e1990,_0x1cb5b4);const _0x59a6d9={'tag':'li','attributes':{'class':['ck','ck-presence-list__dropdown-list-item'],'tabindex':-0x1,'role':'presentation','aria-label':_0x1cb5b4['name']},'children':[this['userView'],{'tag':'span','attributes':{'class':['ck','ck-user__full-name']},'children':[{'text':_0x1cb5b4['name']}]},{'tag':'span','attributes':{'class':['ck','ck-presence-list__marker',_0x1cb5b4['color']['getBackgroundColorClass']()],'aria-hidden':'true'}}]};_0x7b1a9f&&(_0x59a6d9['tag']='button',_0x59a6d9['on']={'click':_0x1cfb3d['to'](()=>this['fire']('execute'))}),this['setTemplate'](_0x59a6d9);}['focus'](){this['element']['focus']();}}class y extends _0x314b86{['userView'];['markerView'];constructor(_0x15b4af,_0x1228bc,_0x124696){super(_0x15b4af);const _0x147729=this['bindTemplate'];this['set']('isFocusable',!0x1),this['set']('hasTooltip',!0x0),this['set']('tooltipPosition',''),this['userView']=new ct(_0x15b4af,_0x1228bc),this['markerView']=new at(_0x15b4af,_0x1228bc);const _0x3eee9f=new ot(_0x15b4af);_0x3eee9f['template']['tag']='span',_0x3eee9f['text']=_0x1228bc['name'];const _0xff065c={'tag':'div','attributes':{'class':['ck','ck-presence-list__list-item'],'role':'listitem','tabindex':_0x147729['to']('isFocusable',_0x38773a=>!!_0x38773a&&0x0),'aria-labelledby':_0x3eee9f['id'],'data-cke-tooltip-text':this['userView']['name'],'data-cke-tooltip-position':_0x147729['to']('tooltipPosition'),'data-cke-tooltip-disabled':_0x147729['to']('hasTooltip',_0x4c21bf=>!_0x4c21bf),'data-cke-tooltip-class':'ck-presence-list__list-item__tooltip'},'children':[this['userView'],this['markerView'],_0x3eee9f]};_0x124696&&(_0xff065c['tag']='button',_0xff065c['on']={'click':_0x147729['to'](()=>this['fire']('execute'))}),this['setTemplate'](_0xff065c);}}class at extends _0x314b86{constructor(_0x3f5ae5,_0x1ef364){super(_0x3f5ae5),this['setTemplate']({'tag':'span','attributes':{'class':['ck','ck-presence-list__marker',_0x1ef364['color']['getBackgroundColorClass']()],'aria-hidden':'true'}});}}const C={'collapseAt':0x6,'displayMe':!0x0};class r extends _0x353ca5{['currentDisplayedUsers'];['balloonPanelView'];['view'];['presenceDropdownView'];['_bodyCollection']=null;static get['pluginName'](){return'PresenceListUI';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}constructor(_0x4817a7){super(_0x4817a7),this['context']['config']['define']('presenceList',C);const _0x360056=_0x4817a7['config']['get']('presenceList.collapseAt');if('number'!=typeof _0x360056)throw new _0x1f3dd5('presencelist-collapseat-invalid-format',this);if(_0x360056<0x1)throw new _0x1f3dd5('presencelist-collapseat-invalid-format',this);this['_allConnectedUsers']=this['context']['plugins']['get'](i)['allConnectedUsers'],this['set']('usersCount',0x0),this['currentDisplayedUsers']=new _0x9408dd(),this['balloonPanelView']=new _0x169d4d(),this['balloonPanelView']['class']='ck\x20ck-presence-list__balloon',this['view']=this['_createView'](),this['presenceDropdownView']=void 0x0;}static get['requires'](){return[i];}['init'](){for(const _0x15abca of this['_allConnectedUsers'])this['_handleUserAdd'](_0x15abca);this['listenTo'](this['_allConnectedUsers'],'add',(_0x4172e9,_0x51c1ea)=>{this['_handleUserAdd'](_0x51c1ea);}),this['listenTo'](this['_allConnectedUsers'],'remove',(_0x37a515,_0x1fb7d1)=>{this['_handleUserRemove'](_0x1fb7d1);});}['_createView'](){const _0x221bc6=this['context'],_0x7bb993=new j(this['context']['locale'],this['context']['config']['get']('presenceList.collapseAt')),_0x47b356=this['balloonPanelView'];if(!_0x3b8005(_0x221bc6['config']['get']('presenceList.container')))throw new _0x1f3dd5('presencelist-missing-container',this);return _0x7bb993['counterView']['bind']('usersCount')['to'](this),_0x7bb993['bind']('isCollapsed')['to'](this,'usersCount',_0x2662a2=>{const {collapseAt:_0x48af08}=_0x221bc6['config']['get']('presenceList'),_0x3e4e3c=_0x2662a2>=_0x48af08;if(_0x3e4e3c&&!_0x7bb993['inlineListView']['items']['find'](_0x388d47=>_0x388d47 instanceof A)){const _0xaf7e8f=this['context']['config']['get']('presenceList.collapseAt')-0x1;this['currentDisplayedUsers']['length']==_0xaf7e8f&&this['currentDisplayedUsers']['length']>0x1&&this['currentDisplayedUsers']['remove'](this['currentDisplayedUsers']['length']-0x1),_0x7bb993['inlineListView']['items']['add'](_0x7bb993['counterView']);}return _0x3e4e3c||this['hideDropdown'](),_0x3e4e3c;}),_0x7bb993['inlineListView']['items']['bindTo'](this['currentDisplayedUsers'])['using'](_0x52bf26=>{const _0x12d3c2=_0x221bc6['config']['get']('presenceList'),_0x20deeb=new y(_0x221bc6['locale'],_0x52bf26,!!_0x12d3c2['onClick']);return _0x20deeb['bind']('hasTooltip')['to'](_0x7bb993,'isCollapsed',_0x3f1796=>!_0x3f1796),_0x20deeb['bind']('isFocusable')['to'](_0x7bb993,'isCollapsed',_0xeb2fa7=>!_0xeb2fa7),_0x12d3c2['onClick']&&this['listenTo'](_0x20deeb,'execute',()=>{this['view']['isCollapsed']||_0x12d3c2['onClick'](_0x52bf26,_0x20deeb['element']);}),_0x20deeb;}),this['listenTo'](_0x7bb993['inlineListView'],'presencelist:show',()=>{this['view']['isCollapsed']&&this['showDropdown']();}),this['listenTo'](_0x7bb993['inlineListView'],'presencelist:hide',()=>{this['presenceDropdownView']&&this['hideDropdown']();}),_0x7bb993['inlineListView']['keystrokes']['set']('Enter',(_0x3ebb01,_0x52fd3f)=>{this['view']['isCollapsed']&&(this['showDropdown'](),_0x52fd3f());}),_0x7bb993['render'](),_0x47b356['render'](),_0x48669f({'emitter':_0x7bb993,'activator':()=>_0x47b356['isVisible'],'contextElements':[_0x47b356['element'],_0x7bb993['inlineListView']['element']],'callback':()=>this['hideDropdown']()}),_0x221bc6['config']['get']('presenceList.container')['appendChild'](_0x7bb993['element']),this['_bodyCollection']=new _0x55c731(this['context']['locale']),this['_bodyCollection']['attachToDom'](),this['_bodyCollection']['add'](this['balloonPanelView']),_0x7bb993;}['_handleUserAdd'](_0x414540){if(!this['context']['config']['get']('presenceList.displayMe')&&_0x414540['isMe'])return;const _0x25cbd4=this['context']['config']['get']('presenceList.collapseAt')-0x1;for(this['usersCount']++;this['currentDisplayedUsers']['length']>=_0x25cbd4-(this['view']['isCollapsed']?0x1:0x0)&&this['currentDisplayedUsers']['length']>0x1;)this['currentDisplayedUsers']['remove'](0x1);const _0x15760b=_0x414540['isMe']?0x0:this['currentDisplayedUsers']['length'];this['currentDisplayedUsers']['add'](_0x414540,_0x15760b);}['_handleUserRemove'](_0x5e794c){this['usersCount']--;const {collapseAt:_0x1008c6}=this['context']['config']['get']('presenceList'),_0x1f4a63=this['usersCount']>=_0x1008c6;if(this['currentDisplayedUsers']['get'](_0x5e794c['id']))this['currentDisplayedUsers']['remove'](_0x5e794c['id']);else{if(_0x1f4a63&&this['currentDisplayedUsers']['length']+0x1===_0x1008c6-0x1)return;}if(this['currentDisplayedUsers']['length']+(_0x1f4a63?0x1:0x0)<this['usersCount']){for(const _0x3a2f27 of Array['from'](this['_allConnectedUsers'])['reverse']())if(!this['currentDisplayedUsers']['get'](_0x3a2f27['id'])&&(this['currentDisplayedUsers']['add'](_0x3a2f27,Math['min'](this['currentDisplayedUsers']['length']-(_0x1f4a63?0x1:0x0),0x1)),this['currentDisplayedUsers']['length']+(_0x1f4a63?0x1:0x0)===_0x1008c6-0x1))return;}}['showDropdown'](){if(this['presenceDropdownView'])return;const _0x46c182=this['context']['config']['get']('presenceList');this['presenceDropdownView']=new x(this['context']['locale'],!!_0x46c182['onClick']),this['view']['inlineListView']['isExpanded']=!0x0,this['listenTo'](this['presenceDropdownView'],'presencelist:hide',()=>{this['presenceDropdownView']&&this['hideDropdown']();});const {listWrapperView:_0x1a95f1}=this['presenceDropdownView'];_0x1a95f1['items']['bindTo'](this['_allConnectedUsers'])['using'](_0x495fbc=>{if(!_0x46c182['displayMe']&&_0x495fbc['isMe'])return null;const _0x102af8=new k(this['context']['locale'],_0x495fbc,!!_0x46c182['onClick']);return _0x46c182['onClick']&&this['listenTo'](_0x102af8,'execute',()=>{_0x46c182['onClick'](_0x495fbc,_0x102af8['element']);}),_0x102af8;}),this['balloonPanelView']['content']['add'](this['presenceDropdownView']),this['balloonPanelView']['pin']({'target':this['view']['inlineListView']['element']}),_0x1a95f1['focus'](),_0x1a95f1['checkIfScrollable']();const _0x2abf70=(_0x2f8182,_0x2717e8)=>{this['hideDropdown'](),this['view']['inlineListView']['focus'](),_0x2717e8();};_0x1a95f1['keystrokes']['set']('Esc',_0x2abf70),_0x1a95f1['keystrokes']['set']('Shift+Tab',_0x2abf70),_0x1a95f1['keystrokes']['set']('Tab',(_0x132f08,_0x1e174a)=>{!function(_0x4a5153){const _0x47d38f=['a','button','input','select','textarea','[tabindex]','[contenteditable]']['map'](_0x1beba0=>_0x1beba0+':not([disabled]):not([tabindex=\x22-1\x22])')['join'](','),_0x33b522=[...document['body']['querySelectorAll'](_0x47d38f)]['filter'](_0x3a09ad=>_0x3a09ad===document['activeElement']||_0x3a09ad['offsetWidth']+_0x3a09ad['offsetHeight']>0x0)['sort']((_0x17f482,_0x3e8798)=>(_0x17f482['tabIndex']||0x0)-(_0x3e8798['tabIndex']||0x0)),_0x26bcf1=_0x33b522['indexOf'](_0x4a5153),_0x21504f=_0x33b522[(_0x26bcf1+0x1)%_0x33b522['length']];_0x21504f&&_0x21504f['focus']();}(this['view']['element']),this['hideDropdown'](),_0x1e174a();}),_0x1a95f1['focusTracker']['add'](this['view']['element']),_0x1a95f1['focusTracker']['on']('change:isFocused',(_0x492c96,_0x130069,_0x496a4e)=>{_0x496a4e||this['hideDropdown']();});}['hideDropdown'](){this['presenceDropdownView']&&(this['view']['inlineListView']['isExpanded']=!0x1,this['balloonPanelView']['unpin'](),this['balloonPanelView']['content']['remove'](this['presenceDropdownView']),this['presenceDropdownView']['destroy'](),this['presenceDropdownView']=void 0x0);}['destroy'](){super['destroy'](),this['view']&&this['view']['isRendered']&&this['view']['destroy'](),this['_bodyCollection']&&(this['_bodyCollection']['detachFromDom'](),this['_bodyCollection']['destroy'](),this['_bodyCollection']=null);}}class s extends _0x353ca5{static get['requires'](){return[i,r];}static get['pluginName'](){return'PresenceList';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}}export{a as CloudServicesCommentsAdapter,u as CloudServicesRevisionHistoryAdapter,f as CloudServicesTrackChangesAdapter,s as PresenceList,r as PresenceListUI,l as RealTimeCollaborationClient,m as RealTimeCollaborativeComments,n as RealTimeCollaborativeEditing,g as RealTimeCollaborativeRevisionHistory,p as RealTimeCollaborativeTrackChanges,i as Sessions};